<!doctype html>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="profile" href="http://gmpg.org/xfn/11">
	<!-- <script type='text/javascript' src='//1.www.s81c.com/common/v18/js/www.js'></script> -->
	<title>HTTP server push with WebSocket and SSE &#8211; IBM Developer</title>
<link rel='dns-prefetch' href='//unpkg.com' />
<link rel='dns-prefetch' href='//1.www.s81c.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="IBM Developer &raquo; Feed" href="https://developer.ibm.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="IBM Developer &raquo; Comments Feed" href="https://developer.ibm.com/comments/feed/" />
    <link rel="canonical" href="https://developer.ibm.com/articles/wa-http-server-push-with-websocket-sse/" />
    <meta name="description" content="WebSocket and SSE are two leading server push solutions for real-time streaming in web and mobile applications, but how do they compare? A Python web app highlights the strengths and limits of each protocol, then gets you over the hump of troubleshooting connection issues in the WebSocket frontend." />
    <meta name="keywords" content="WebSocket, SSE, server-sent events, HTTP server push, real-time data streaming">
    <meta property="og:title" content="HTTP server push with WebSocket and SSE" />
    <meta property="og:description" content="WebSocket and SSE are two leading server push solutions for real-time streaming in web and mobile applications, but how do they compare? A Python web app highlights the strengths and limits of each protocol, then gets you over the hump of troubleshooting connection issues in the WebSocket frontend." />
    <meta property="og:type" content="Article" />
    <meta property="og:site_name" content="IBM Developer" />
    <meta property="og:url" content="https://developer.ibm.com/articles/wa-http-server-push-with-websocket-sse/" />
    <meta property="og:image" content="https://wdc.objectstorage.softlayer.net/v1/AUTH_7046a6f4-79b7-4c6c-bdb7-6f68e920f6e5/web/social/articles.jpg"/>
    <meta property="twitter:account_id" content="15651700" />
    <meta name="twitter:card" content="summary">    <meta name="twitter:url" content="https://developer.ibm.com/articles/wa-http-server-push-with-websocket-sse/">
    <meta name="twitter:title" content="HTTP server push with WebSocket and SSE">
    <meta name="twitter:description" content="WebSocket and SSE are two leading server push solutions for real-time streaming in web and mobile applications, but how do they compare? A Python web app highlights the strengths and limits of each protocol, then gets you over the hump of troubleshooting connection issues in the WebSocket frontend.">
    <meta name="twitter:image" content="https://wdc.objectstorage.softlayer.net/v1/AUTH_7046a6f4-79b7-4c6c-bdb7-6f68e920f6e5/web/social/articles.jpg">
    <meta property="twitter:image:src" content="https://wdc.objectstorage.softlayer.net/v1/AUTH_7046a6f4-79b7-4c6c-bdb7-6f68e920f6e5/web/social/articles.jpg" />
    <meta name="twitter:site" content="https://developer.ibm.com">
    <meta name="twitter:creator" content="@ibmcode">

    
    <!-- BEGIN: Use this section to set page specific variables for the Page Tag -->
  	<script language="JavaScript">var NTPT_PGEXTRA="ibmCmaId=115804&ibmContentAreas=Mobile development,Web development,";</script>
  	<!--END -->
    <script>
  		digitalData = {
  				"page": {
  					"category": {
  						"primaryCategory": "SOFDCACLZZ"
  					},
  					"pageInfo": {
  						"effectiveDate": "2017-05-05T00:00:00",
  						"language": "en",
  						"publishDate": "2017-05-05 00:00:00",
  						"expiryDate": "",
  						"publisher": "IBM Corporation",
  						"version": "v18",
  						"ibm": {
  							"contentDelivery": "IBM Developer template",
  							"contentProducer": "IBM Developer",
  							"country": "ZZ",
                "contentArea": "Mobile development,Web development,",
  							"owner": "developerWorks Content/Raleigh/IBM",
  							"siteID": "DWNEXT",
  							"subject": "ZZ000",
  							"type": "CT316",
  							"contentId": "115804",
  						},
  						"keywords": "WebSocket, SSE, server-sent events, HTTP server push, real-time data streaming",
  						"description": "WebSocket and SSE are two leading server push solutions for real-time streaming in web and mobile applications, but how do they compare? A Python web app highlights the strengths and limits of each protocol, then gets you over the hump of troubleshooting connection issues in the WebSocket frontend."
  					}
  				}
  			};

        window._analytics = {
          "coremetrics": false,
          "optimizely": false,
          "googleAddServices": false,
          "addRoll": false,
          "intercom": false,
          "fullStory": false,
          "hotjar": false,
          "tealeaf": false,
          "nps": false,
          "segment_key": 'HU3dbkAG5wE0F1IkRf9S1RexlAqo3jby'
        };
  	</script>
  	<!-- Segment meta tag -->
  	<meta name="segment" property="developerWorks (developerWorks)" productTitle="developerWorks" value="Home English (developerWorks)"/>


    		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/developer.ibm.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.10"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='ibmcode-articles-css'  href='https://developer.ibm.com/site-content/plugins/ibmcode-articles/public/css/ibmcode_articles.css?ver=1.0.0' type='text/css' media='all' />
<link rel='stylesheet' id='carbon-styles-css'  href='https://developer.ibm.com/site-content/themes/lucio/carbon/carbon-components.css?ver=4.9.10' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://developer.ibm.com/wp-includes/css/dashicons.min.css?ver=4.9.10' type='text/css' media='all' />
<link rel='stylesheet' id='lucio-style-css'  href='https://developer.ibm.com/site-content/themes/lucio/style.css?ver=v2' type='text/css' media='all' />
<link rel='stylesheet' id='pagepost_css-css'  href='https://developer.ibm.com/site-content/themes/lucio/css/pagepost.css?ver=4.9.10' type='text/css' media='all' />
<script type='text/javascript' src='https://developer.ibm.com/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://developer.ibm.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var authLinkAction = {"ajax_url":"https:\/\/developer.ibm.com\/wp-admin\/admin-ajax.php","nonce":"c181a63835"};
/* ]]> */
</script>
<script type='text/javascript' src='https://developer.ibm.com/site-content/plugins/w3-ibm-id-auth/includes/../js/authPageAccess.js?ver=4.9.10'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpp_params = {"sampling_active":"1","sampling_rate":"100","ajax_url":"https:\/\/ibmcode-staging.us-east.containers.mybluemix.net\/wp-json\/wordpress-popular-posts\/v1\/popular-posts\/","ID":"115804","token":"eeda03776f","debug":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://developer.ibm.com/site-content/plugins/wordpress-popular-posts/public/js/wpp-4.2.0.min.js?ver=4.2.0'></script>
<script type='text/javascript' src='https://developer.ibm.com/site-content/themes/lucio/js/ibmcode.js?ver=20151215'></script>
<script type='text/javascript' src='https://unpkg.com/carbon-components@latest/scripts/carbon-components.js?ver=4.9.10'></script>
<script type='text/javascript' src='//1.www.s81c.com/common/stats/ida_stats.js'></script>
<link rel='https://api.w.org/' href='https://developer.ibm.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://developer.ibm.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://developer.ibm.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Functional alternatives to the traditional for loop' href='https://developer.ibm.com/articles/j-java8idioms3/' />
<link rel='next' title='Native JavaScript applications on IBM i with Node.js' href='https://developer.ibm.com/articles/i-native-js-app-ibmi-with-nodejs/' />
<meta name="generator" content="WordPress 4.9.10" />
<link rel="canonical" href="https://developer.ibm.com/articles/wa-http-server-push-with-websocket-sse/" />
<link rel='shortlink' href='https://developer.ibm.com/?p=115804' />
<link rel="alternate" type="application/json+oembed" href="https://developer.ibm.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fdeveloper.ibm.com%2Farticles%2Fwa-http-server-push-with-websocket-sse%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://developer.ibm.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fdeveloper.ibm.com%2Farticles%2Fwa-http-server-push-with-websocket-sse%2F&#038;format=xml" />
<link rel="icon" href="https://developer.ibm.com/site-content/uploads/2018/12/bee_128.png" sizes="32x32" />
<link rel="icon" href="https://developer.ibm.com/site-content/uploads/2018/12/bee_128.png" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="https://developer.ibm.com/site-content/uploads/2018/12/bee_128.png" />
<meta name="msapplication-TileImage" content="https://developer.ibm.com/site-content/uploads/2018/12/bee_128.png" />
	</head>
<body id="ibm-com" class="ibmcode_articles-template-default single single-ibmcode_articles postid-115804 ibm-code ibm-com ibm-type">
	<div class="code_adorn_announcement">
								<div class="code_content__wrap"><style>
  .c4c-announcement{
    background: #e9e9e9;
    min-height: 53px;
    box-sizing: border-box;
    padding-top: 10px;
    padding-bottom: 10px;
  }
  .c4c-announcement p{
    text-align: center;
    font-size: 1.125rem;
    line-height: 1.125rem;
    font-weight: 300;
  }
  .c4c-announcement a p{
    display: table;
    color: #1e1e1e;
    width: auto;
    margin: 0 auto;
  }
  .c4c-announcement a {
    text-decoration: none;
    display: block;
    text-align: center;
  }
  .c4c-announcement a p strong{
    color: #333 !important;
    padding: 10px 20px !important;
    margin-left: 10px;
    display: inline-block;
    background-color: #56d3d0;
    color: #000;
    font-weight: 600;
    font-size: 1.2rem;
    margin-top: 10px;
    margin-bottom: 10px;
  }
  .c4c-announcement a p i{
    padding-left: 20px;
    font-style: italic;
  }
</style>
<div class="c4c-announcement">
<a href="https://developer.ibm.com/callforcode/">
<p>On this World Health Day, make a difference with your code and the chance to win $200,000 <strong>Find out how</strong></p>
</a>
</div>
</div>
							</div>
	
	<div id="site-navigation" class="site-navigation">
		<div class="code_content__wrap">
		  <nav class="bx--cloud-header" role="navigation" aria-label="site navigation">
		    <div class="bx--cloud-header__wrapper leftnav">
					<span style="display:none">https://developer.ibm.com</span>
		  		<a id="logo" href="//developer.ibm.com">IBM <span>Developer</span></a>
					<!-- <button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false"><span class="x-dashicons x-dashicons-menu"></span></button> -->
					<div class="site-navigation__wrap">
						<h6>Main Menu</h6>
			  		<ul id="primary-menu" class="bx--cloud-header-list"><li id='topics' class=' menu-item menu-item-type-custom menu-item-object-custom menu-item menu-item-type-custom menu-item-object-custom menu-item-has-mega'><a href="/technologies/">Topics<svg width="10" height="5" viewBox="0 0 10 5" fill-rule="evenodd"><path d="M10 0L5 5 0 0z"/></svg></a><div class="mega-menu"><div class="bx--grid">
  <div class="bx--row no-pad-t">
  </div>
  <div class="bx--row add-line-b">
    <div class="bx--col-md-4">     
      <h5>Technologies</h5> 
      <ul>
        <li><a href="/technologies/analytics/">Analytics</a></li>
        <li><a href="/technologies/artificial-intelligence/">Artificial Intelligence</a></li>
        <li><a href="/technologies/blockchain/">Blockchain</a></li>
        <li><a href="/technologies/containers/">Containers</a></li>  
        <li><a href="/technologies/iot/">IoT</a></li>  
        <li><a href="/technologies/java/">Java</a></li>
      </ul>
    </div>
    <div class="bx--col-md-4">
      <h5>&nbsp;</h5>
      <ul>       
        <li><a href="/technologies/linux/">Linux</a></li>
        <li><a href="/technologies/microservices/">Microservices</a></li>
        <li><a href="/technologies/mobile/">Mobile</a></li>
        <li><a href="/technologies/node-js/">Node.js</a></li>
        <li><a href="/technologies/serverless/">Serverless</a></li>
        <li><a href="/technologies/">ALL TECHNOLOGIES</a></li>
      </ul>
    </div>
    <div class="bx--col-md-4">
      <h5>Components</h5>
      <ul>
        <li><a href="/components/cloud-foundry/">Cloud Foundry</a></li>
        <li><a href="/components/cloud-private/">IBM Cloud Private</a></li>
        <li><a href="/components/z-systems/">IBM Z</a></li>
        <li><a href="/components/node-red/">Node-RED</a></li>
        <li><a href="/components/open-liberty/">Open Liberty</a></li>
        <li><a href="/components/">ALL COMPONENTS</a></li>
      </ul>
    </div>
  </div>
  <div class="bx--row">
    <div class="bx--col-md-4">
      <h5>Industries</h5>
      <ul>
        <li><a href="/industries/gaming/">Gaming</a></li>
        <li><a href="/industries/finance/">Finance</a></li>
        <li><a href="/industries/retail/">Retail</a></li>
        <li><a href="/industries/">ALL INDUSTRIES</a></li>
      </ul>
    </div>
    <div class="bx--col-md-4">
      <h5>Deployment Models</h5>
      <ul>
        <li><a href="/depmodels/cloud/">Cloud</a></li>
        <li><a href="/depmodels/hybrid/">Hybrid Cloud</a></li>
        <li><a href="/depmodels/offline/">Offline</a></li>
        <li><a href="/depmodels/">ALL DEPLOYMENT MODELS</a></li>
      </ul>
    </div>
    <div class="bx--col-md-4">
      <h5>Solutions</h5>
      <ul>
        <li><a href="/solutions/ai-development/">AI Development</a></li>
        <li><a href="/solutions/blockchain-app-development/">Blockchain Development</a></li>
        <li><a href="/solutions/container-orchestration-and-deployment/">Container Orchestration and Development</a></li>
        <li><a href="/solutions/mobile-app-development/">Mobile App Development</a></li>
      </ul>
    </div>
  </div>
</div></div></li>
<li id='community' class=' menu-item menu-item-type-custom menu-item-object-custom menu-item menu-item-type-custom menu-item-object-custom menu-item-has-mega'><a href="/community/">Community<svg width="10" height="5" viewBox="0 0 10 5" fill-rule="evenodd"><path d="M10 0L5 5 0 0z"/></svg></a><div class="mega-menu"><div class="bx--grid">
  <div class="bx--row">
    <div class="bx--col-md-12">      
      <ul>
          <li><a href="/community/">Community home</a></li> 
          <li><a href="/blogs/">The Blog</a></li>  
          <li><a href="/events/">Events</a></li>  
          <li><a href="/cities/">Cities</a></li>  
          <li><a href="/newsletters/">Newsletters</a></li>  
          <li><a href="https://ibmcoders.influitive.com">IBM Coder program</a></li>
          <li><a href="/champions/">IBM Champions</a></li>  
      </ul>
    </div>
</div></div></li>
<li id='more_open_source_at_ibm' class=' menu-item menu-item-type-custom menu-item-object-custom menu-item menu-item-type-custom menu-item-object-custom menu-item-has-mega'><a href="/open/">More open source at IBM<svg width="10" height="5" viewBox="0 0 10 5" fill-rule="evenodd"><path d="M10 0L5 5 0 0z"/></svg></a><div class="mega-menu"><div class="bx--grid">
  <div class="bx--row">
    <div class="bx--col-md-12">      
      <ul>
          <li><a href="/open/">Open source at IBM</a></li>  
          <li><a href="/collections/open-stories/">Open stories</a></li>  
          <li><a href="/open/code/">Projects</a></li>  
          <li><a href="/open/community/">Communities</a></li>  
          <li><a href="/open/culture/">Become an open enterprise</a></li>  
          <li><a href="/exchanges/models/">Model asset exchange</a></li>
      </ul>
    </div>
</div></div></li>
</ul>					</div>
		    </div>
		    <div class="bx--cloud-header__wrapper rightnav">
		      <ul class="bx--cloud-header-list" >
						<li class="bx--cloud-header-list__item bx--cloud-header-list__item--icon">
							<button class="bx--cloud-header-list__btn" type="button" id="searchModalOpen">
								<svg viewBox="0 0 16 16" fill-rule="evenodd">
									<title>search</title>
									<path d="M6 2c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zm0-2C2.7 0 0 2.7 0 6s2.7 6 6 6 6-2.7 6-6-2.7-6-6-6zm10 13.8L13.8 16l-3.6-3.6 2.2-2.2z" />
									<path d="M16 13.8L13.8 16l-3.6-3.6 2.2-2.2z" />
								</svg>
		          </button>
						</li>
													<li class="bx--cloud-header-list__item bx--cloud-header-list__item--icon">
								<button class="bx--cloud-header-list__btn" type="button">
									<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M16 2a14 14 0 1 0 14 14A14 14 0 0 0 16 2zm-6 24.38v-2A3.22 3.22 0 0 1 13 21h6a3.22 3.22 0 0 1 3 3.39v2a11.92 11.92 0 0 1-12 0zm14-1.46v-.61A5.21 5.21 0 0 0 19 19h-6a5.2 5.2 0 0 0-5 5.31v.59a12 12 0 1 1 16 0z"/><path d="M16 7a5 5 0 1 0 5 5 5 5 0 0 0-5-5zm0 8a3 3 0 1 1 3-3 3 3 0 0 1-3 3z"/></svg>
								</button>
								<div class="mega-menu">
									<div class="inner">
										<ul id="ibm-signin-minimenu-container" role="menu" aria-label="Profile" class="ibm-dropdown-menu">
											<li role="presentation">
												<a role="menuitem" href="https://myibm.ibm.com/?lnk=mmi" tabindex="0">My IBM</a>
											</li>
											<li role="presentation" data-linktype="signin">
												<a role="menuitem" href="https://developer.ibm.com/sso/login?d=https://developer.ibm.com/articles/wa-http-server-push-with-websocket-sse/&lang=us_EN" tabindex="-1">Log in</a>
											</li>
										</ul>
									</div>
								</div>
							</li>
						
						<li class="bx--cloud-header-list__item bx--cloud-header-list__item--icon search">
							<button id="mobileMenuToggle" class="bx--cloud-header-list__btn x-menu-toggle" aria-controls="primary-menu" aria-expanded="false">
								<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M4 6h24v2H4zm0 18h24v2H4zm0-9h24v2H4z"/></svg>
							</button>
		        </li>
		      </ul>
		    </div>
		  </nav>
		</div>
	</div>
  <!-- MASTHEAD_END -->
	<div id="site-content" class="code_content__wrap" role="main">
		<a class="skip-link screen-reader-text" href="#content">Skip to content</a>
		<div id="ibm-content-wrapper">
			<div id="content" class="site-content">
<div class="code--taxonomy__hero">
          <div class="inner">
            <a class="taxonomy_linkback" href="/technologies/web-development/">
              <div class="code--taxonomy__icon"><img alt="Taxonomy Icon" src="https://wdc.objectstorage.softlayer.net/v1/AUTH_7046a6f4-79b7-4c6c-bdb7-6f68e920f6e5/web/technologies/web-development-featured.svg" height="75" scale="0"></div>
              <h2 class="taxonomy__hero-heading">Web development</h2>
            </a>
            <a href="#" id="code_aside__navtoggle_open"></a>
          </div>
        </div>
<!-- begin new layout -->
<div class="code_container page ">
  <div class="code_aside">
    <div id="code_aside__navwrap"><div id="code_leftnav" class="code_leftnav"><nav role="navigation" aria-label="Code portlet"><h4>Code</h4><ul id="menu-code-nav" class=""><li><a href="/exchanges/models/all/category/web-development/">Models</a></li><li><a href="/patterns/category/web-development/">Code Patterns</a></li><li><a href="/open/projects/category/web-development/">Open Projects</a></li></ul></nav><nav role="navigation" aria-label="Content portlet"><h4>Content</h4><ul id="menu-content-nav" class=""><li><a href="/announcements/category/web-development/">Announcements</a></li><li><a href="/articles/category/web-development/">Articles</a></li><li><a href="/series/category/web-development/">Series</a></li><li><a href="/tutorials/category/web-development/">Tutorials</a></li><li><a href="/videos/category/web-development/">Videos</a></li></ul></nav><nav role="navigation" aria-label="Community portlet"><h4>Community</h4><ul id="menu-community-nav" class=""><li><a href="/blogs/category/web-development/">Blogs</a></li><li><a href="/events/category/web-development/">Events</a></li></ul></nav><nav> <h4>RELATED TOPICS</h4> <ul><li><a href="/technologies/mobile/">Mobile</a></li> <li><a href="/technologies/php/">PHP</a></li> </ul> </nav></div><div id="code_aside__overlay" class="code_aside__overlay"></div><button id="code_aside__navtoggle_close"><span class="dashicons dashicons-no-alt"></span> <i>Close</i></button></div>  </div>
  <div class="code_main">
<!-- begin new layout -->
<div class="code_postcontent">
  <div class="cpt-body">
    <div class="cpt-byline">
      <div class="cpt-byline__wrap">
        <p class="cpt-byline__posttype"><span>Article</span></p>
        <h1 class="cpt-byline__title">HTTP server push with WebSocket and SSE</h1>        <h2 class="cpt-byline__subtitle">Real-time data streaming for your web and mobile applications</h2>        <p class="cpt-byline__author">by Daniel Barboza | Published May 5, 2017</p>
                <p class="cpt-byline__categories"><a href="https://developer.ibm.com/articles/category/mobile/" class="bx--tag bx--tag--category">Mobile development</a><a href="https://developer.ibm.com/articles/category/web-development/" class="bx--tag bx--tag--category">Web development</a></p>        <hr>
      </div>
    </div>

        <div class="cpt-content">
      <div class="cpt-content__wrap">
        <section class="wp-content">
          <!-- begin main body content -->
          <p xmlns="http://www.w3.org/1999/xhtml">HTTP server push, also known as HTTP streaming, is a client-server communication pattern that sends information from an HTTP server to a client asynchronously, without a client request. A server push architecture is especially effective for highly interactive web or mobile applications, where one or more clients need to receive continuous information from the server. In this article you&#8217;ll learn about WebSocket and SSE (server-sent events), two technologies that implement HTTP server push.</p>
<p>I start with an overview of the technical differences between the two solutions and how each one is implemented in a web architecture. Using an example application, I show you how setup an SSE implementation, followed by a similar implementation for WebSockets. Finally, l compare the two technologies and offer my conclusions about using them for different types of web or mobile applications.</p>
<p>Note that this article assumes familiarity with the language and concepts of HTTP server push. Both applications are written in Python using CherryPy.</p>
<h2 id="the-limits-of-request-response">The limits of request-response</h2>
<p>Client-server communication on the web has historically been a request-response model, requiring the client (such as a web browser) to request resources from the server. The server responds to a client request by sending the requested resource. If the resource is unavailable, or if the client doesn&#8217;t have permission to access it, the server will send an error message. In a request-response architecture, a server can never send an unsolicited message to a client.</p>
<p>As web applications evolved to be more powerful and interactive, the limits of the request-response model started to show. Client applications needing more frequent updates were required to send more frequent <code style="font-family:monospace;font-size:1rem">GET</code> requests. This technique, known as <em>polling</em>, can overload the server during peak periods, causing performance issues. It&#8217;s inefficient because the client sends many requests that return without an update. Additionally, clients can only poll at specified intervals, which can slow client responsiveness.</p>
<p>HTTP server push technologies emerged to resolve the performance issues and other limitations associated with frequent polling. Especially for interactive web apps such as games or screen-sharing services, it is more efficient for the web server to send updates to the client whenever new data is available.</p>
<h2 id="comparing-websocket-and-sse">Comparing WebSocket and SSE</h2>
<p>WebSocket and SSE are both alternatives to the traditional request-response web architecture, but they are not exactly competing technologies. A WebSocket architecture consists of a socket that is opened between the client and the server for full-duplex (bidirectional) communication. Instead of sending a <code style="font-family:monospace;font-size:1rem">GET</code> message and waiting for a server response, the client simply listens to the socket, receiving server updates and using the data to initiate or support various interactions. A client can also use the socket to communicate with the server, for instance by sending an <code style="font-family:monospace;font-size:1rem">ACK</code> message when an update has been successfully received.</p>
<p>SSE is a simpler standard, developed as an extension of HTML5. While SSE enables asynchronous messages from the server to the client, the client cannot send messages to the server. SSE&#8217;s half-duplex communication model is best suited to applications where the client simply needs to receive streaming updates from the server. One advantage of SSE over WebSocket is that it works over HTTP, without requiring additional components.</p>
<p>For a multipurpose web application requiring extensive communication between client and server, WebSocket is the obvious choice. SSE is more suitable for applications that want to stream asynchronous data to the client from the server, but do not require a response back.</p>
<h3 id="browser-support">Browser support</h3>
<p>Browser support is an essential factor when comparing HTTP protocols. From the browsing data in Table 1, you can see that the <a href="http://caniuse.com/#feat=WebSockets">WebSocket</a> protocol is supported across all modern browsers, including mobile ones. <a href="http://caniuse.com/#feat=eventsource">SSE</a> isn&#8217;t supported by Microsoft IE or Edge.</p>
<div style="overflow-x:auto"><h5 class="ibm-h5" id="table1">Table 1. Browser usage in January 2017</h5><table class="bx--data-table-v2 bx--data-table-v2--compact" border="0" cellpadding="0" cellspacing="0" data-widget="datatable" summary="Source for desktop and mobile browser data: www.w3schools.com/browsers/"><thead xmlns:dw="http://www.ibm.com/developerWorks/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"> <tr> <th class="ibm-background-neutral-white-30"><span class="bx--table-header-label">2017</span></th> <th class="ibm-background-neutral-white-30"><span class="bx--table-header-label">Chrome</span></th> <th class="ibm-background-neutral-white-30"><span class="bx--table-header-label">IE/Edge</span></th> <th class="ibm-background-neutral-white-30"><span class="bx--table-header-label">Firefox</span></th> <th class="ibm-background-neutral-white-30"><span class="bx--table-header-label">Safari</span></th> <th class="ibm-background-neutral-white-30"><span class="bx--table-header-label">Opera</span></th></tr></thead><tbody xmlns:dw="http://www.ibm.com/developerWorks/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"> <tr> <td> <strong>January</strong></td> <td>73.7%</td> <td>4.9%</td> <td>15.4%</td> <td>3.6%</td> <td>1.0%</td></tr></tbody></table></div>
<p>For applications that must run in all possible browsers, WebSocket is currently the better choice.</p>
<h3 id="development-effort">Development effort</h3>
<p>Effort is another factor to consider when comparing protocols, especially newer ones like WebSocket and SSE. &#8220;Effort&#8221; here refers to lines of code, or how much time you&#8217;ll put into coding your app using the given protocol. This metric is especially important for projects that have a strict time constraint or development budget.</p>
<p>SSE takes considerably less effort to implement than WebSocket. It works with any app written in HTML5, and mainly consists of adding an HTTP header to messages sent from the server to the client. Given the correct header, the client will automatically recognize the message as a server-sent event. Unlike WebSocket, SSE does not require you to establish or maintain a socket connection between the server and client.</p>
<p>The WebSocket protocol requires that you configure a server-side socket that listens for client connections. The client automatically opens a socket to the server and waits for messages, which can be sent asynchronously. Each application may define its own message format, keep-alive (heartbeat) strategy, and so on.</p>
<p>Table 2 summarizes the strengths and weaknesses of the SSE and WebSocket protocols.</p>
<div style="overflow-x:auto"><h5 class="ibm-h5" id="table2">Table 2. Comparing SSE and WebSocket</h5><table class="bx--data-table-v2 bx--data-table-v2--compact" border="0" cellpadding="0" cellspacing="0" data-widget="datatable" summary="summary"><thead xmlns:dw="http://www.ibm.com/developerWorks/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"> <tr> <th class="ibm-background-neutral-white-30"><span class="bx--table-header-label"></span></th> <th class="ibm-background-neutral-white-30"><span class="bx--table-header-label">SSE</span></th> <th class="ibm-background-neutral-white-30"><span class="bx--table-header-label">WebSocket</span></th></tr></thead><tbody xmlns:dw="http://www.ibm.com/developerWorks/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"> <tr> <td> <strong>Type of communication</strong></td> <td>Half-duplex (unidirectional)</td> <td>Full-duplex (bidirectional)</td></tr> <tr> <td> <strong>Browser support</strong></td> <td>Currently not available in Microsoft browsers.</td> <td>Available in all major browsers.</td></tr> <tr> <td> <strong>Development effort</strong></td> <td>Minor: Just need to send an HTTP message with a specific header.</td> <td>Medium: Need to establish and maintain a TCP socket communication. A listener socket on the server side is also required.</td></tr></tbody></table></div>
<p>Now let&#8217;s see how each of these technologies works in a simple web application example.</p>
<h2 id="developing-an-sse-application">Developing an SSE application</h2>
<p>SSE is an HTML5 standard that uses nothing but HTTP to deliver asynchronous messages. Unlike WebSocket, SSE does not require you to create a server socket on the backend, nor to open connections on the frontend. This removes considerable complexity right away.</p>
<h3 id="the-sse-frontend">The SSE frontend</h3>
<p>Listing 1 shows the UI code for a simple HTTP server push application with SSE:</p>
<p><div class="ibm-codeblock"><h5 class="ibm-h5" id="listing1">Listing 1. SSE frontend</h5><div class="bx--snippet bx--snippet--multi" data-code-snippet=""><div class="bx--snippet-container" aria-label="Code Snippet Text"><pre><code>
var source = new EventSource(“/user-log-stream”);
source.onmessage = function(event) {
    var message = event.data;
    // do stuff based on received message
};
</code></pre></div><button data-copy-btn="" class="bx--snippet-button" type="button" aria-label="Copy code" tabindex="0"><svg class="bx--snippet__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M1 10H0V2C0 .9.9 0 2 0h8v1H2c-.6 0-1 .5-1 1v8z"></path><path d="M11 4.2V8h3.8L11 4.2zM15 9h-4c-.6 0-1-.4-1-1V4H4.5c-.3 0-.5.2-.5.5v10c0 .3.2.5.5.5h10c.3 0 .5-.2.5-.5V9zm-4-6c.1 0 .3.1.4.1l4.5 4.5c0 .1.1.3.1.4v6.5c0 .8-.7 1.5-1.5 1.5h-10c-.8 0-1.5-.7-1.5-1.5v-10C3 3.7 3.7 3 4.5 3H11z"></path></svg><div class="bx--btn--copy__feedback" data-feedback="Copied!"></div></button><button class="bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand" type="button"><span class="bx--snippet-btn--text" data-show-more-text="Show more" data-show-less-text="Show less">Show more</span><svg class="bx--icon-chevron--down" width="12" height="7" viewBox="0 0 12 7" aria-label="Show more icon"><title>Show more icon</title><path fill-rule="nonzero" d="M6.002 5.55L11.27 0l.726.685L6.003 7 0 .685.726 0z"></path></svg></button></div></div></p>
<p xmlns="http://www.w3.org/1999/xhtml"><code style="font-family:monospace;font-size:1rem">EventSource</code> is an interface that creates the HTTP connection to the server. The server sends messages to the client using <em>event stream format</em>, a simple stream of text data that is encoded using UTF-8. Once contact has been established, the HTTP connection is kept open for the given message stream, so that the server can send updates. In Listing 1, we&#8217;ve created an HTTP connection to receive events related to the <code style="font-family:monospace;font-size:1rem">/#tabs/user-log-stream</code> URI.</p>
<h3 id="the-sse-backend">The SSE backend</h3>
<p>On the backend, we create a dispatcher for the URL <code style="font-family:monospace;font-size:1rem">/user-log-stream</code>. The dispatcher will receive connection requests from the frontend and send back an asynchronous message to initiate communication. The SSE client cannot send messages to the server.</p>
<p>The code stub in Listing 2 illustrates the backend code.</p>
<p><div class="ibm-codeblock"><h5 class="ibm-h5" id="listing2">Listing 2. SSE backend</h5><div class="bx--snippet bx--snippet--multi" data-code-snippet=""><div class="bx--snippet-container" aria-label="Code Snippet Text"><pre><code>
import cherrypy

class UserLogStream
    messages = 
    @cherrypy.expose
    def stream(self):
        cherrypy.response.headers["Content-Type"] = "text/event-stream"
        while True:
            if len(messages) > 0:
                for msg in messages:
                    data = “data:” + msg + “\n\n”
                    yield data
                 messages = 
routes_dispatcher = cherrypy.dispatch.RoutesDispatcher()
routes_dispatcher.connect(‘user-log-stream’, ‘/’, controller = UserLogStream(), action=’stream’)
</code></pre></div><button data-copy-btn="" class="bx--snippet-button" type="button" aria-label="Copy code" tabindex="0"><svg class="bx--snippet__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M1 10H0V2C0 .9.9 0 2 0h8v1H2c-.6 0-1 .5-1 1v8z"></path><path d="M11 4.2V8h3.8L11 4.2zM15 9h-4c-.6 0-1-.4-1-1V4H4.5c-.3 0-.5.2-.5.5v10c0 .3.2.5.5.5h10c.3 0 .5-.2.5-.5V9zm-4-6c.1 0 .3.1.4.1l4.5 4.5c0 .1.1.3.1.4v6.5c0 .8-.7 1.5-1.5 1.5h-10c-.8 0-1.5-.7-1.5-1.5v-10C3 3.7 3.7 3 4.5 3H11z"></path></svg><div class="bx--btn--copy__feedback" data-feedback="Copied!"></div></button><button class="bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand" type="button"><span class="bx--snippet-btn--text" data-show-more-text="Show more" data-show-less-text="Show less">Show more</span><svg class="bx--icon-chevron--down" width="12" height="7" viewBox="0 0 12 7" aria-label="Show more icon"><title>Show more icon</title><path fill-rule="nonzero" d="M6.002 5.55L11.27 0l.726.685L6.003 7 0 .685.726 0z"></path></svg></button></div></div></p>
<p xmlns="http://www.w3.org/1999/xhtml">The <code style="font-family:monospace;font-size:1rem">stream</code> method of the <code style="font-family:monospace;font-size:1rem">UserLogStream</code> class is assigned to every <code style="font-family:monospace;font-size:1rem">EventSource</code> that connects to the <code style="font-family:monospace;font-size:1rem">/user-log-stream</code> URI. Any pending messages will be sent to the connected <code style="font-family:monospace;font-size:1rem">EventSource</code>. Note that the message format isn&#8217;t optional: the SSE protocol requires that messages start with <code style="font-family:monospace;font-size:1rem">data:</code> and end with <code style="font-family:monospace;font-size:1rem">\n\n</code>. While HTTP is the message format used in these examples, it is possible to send messages using JSON or another format.</p>
<p>This is a very basic example of an SSE implementation, but demonstrates the simplicity of the protocol.</p>
<h2 id="developing-a-websocket-application">Developing a WebSocket application</h2>
<p>Like the SSE example, the WebSocket application is built on top of CherryPy, a Python web framework. <a href="https://github.com/kimchi-project/wok">Project WoK</a> is the backend web server, and the <code style="font-family:monospace;font-size:1rem">python-websockify</code> library plugin handles socket connections. The plugin is part of <a href="https://github.com/kimchi-project/kimchi">Kimchi</a>. Figure 1 shows the architecture of the WebSocket example application. As you can see, it&#8217;s considerably more complex than SSE.</p>
<h5 class="ibm-h5" id="fig1">Figure 1. Architecture of a WebSocket application</h5><img alt="alt" height="370" src="https://developer.ibm.com/developer/articles/wa-http-server-push-with-websocket-sse/images/fig1.png" width="288" class="ibm-downsize"/>
<p>The components are as follows:</p>
<ul>
<li>Project WoK: The backend Python logic that supplies messages to be broadcast by the push server.</li>
<li>Websockify proxy: Implemented by the <code style="font-family:monospace;font-size:1rem">python-websockify</code> library, the proxy receives messages from the push server using Unix sockets and proxies them to connected WebSockets on the UI.</li>
<li>Push server: A regular Unix socket server that broadcasts backend messages to connected clients.</li>
<li>Frontend: The UI establishes a WebSocket connection to the Websockify proxy and listens for server messages. Depending on the message a specific action is taken, for example refreshing a list or showing a message to the user.</li>
</ul>
<h3 id="websockify-proxy">Websockify proxy</h3>
<p>The Websockify proxy is implemented by the <code style="font-family:monospace;font-size:1rem">python-websockify</code> library. It is initialized using the CherryPy web server engine, as shown in Listing 3.</p>
<p><div class="ibm-codeblock"><h5 class="ibm-h5" id="listing3">Listing 3. The Websockify proxy</h5><div class="bx--snippet bx--snippet--multi" data-code-snippet=""><div class="bx--snippet-container" aria-label="Code Snippet Text"><pre><code>
    params = {'listen_host': '127.0.0.1',
              'listen_port': config.get('server', 'websockets_port'),
              'ssl_only': False}

    #old websockify: do not use TokenFile
    if not tokenFile:
        params['target_cfg'] = WS_TOKENS_DIR

    #websockify 0.7 and higher: use TokenFile
    else:
        params['token_plugin'] = TokenFile(src=WS_TOKENS_DIR)

    def start_proxy():
        try:
            server = WebSocketProxy(RequestHandlerClass=CustomHandler,
                                    params)
        except TypeError:
            server = CustomHandler(params)

        server.start_server()

    proc = Process(target=start_proxy)
    proc.start()
    return proc
</code></pre></div><button data-copy-btn="" class="bx--snippet-button" type="button" aria-label="Copy code" tabindex="0"><svg class="bx--snippet__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M1 10H0V2C0 .9.9 0 2 0h8v1H2c-.6 0-1 .5-1 1v8z"></path><path d="M11 4.2V8h3.8L11 4.2zM15 9h-4c-.6 0-1-.4-1-1V4H4.5c-.3 0-.5.2-.5.5v10c0 .3.2.5.5.5h10c.3 0 .5-.2.5-.5V9zm-4-6c.1 0 .3.1.4.1l4.5 4.5c0 .1.1.3.1.4v6.5c0 .8-.7 1.5-1.5 1.5h-10c-.8 0-1.5-.7-1.5-1.5v-10C3 3.7 3.7 3 4.5 3H11z"></path></svg><div class="bx--btn--copy__feedback" data-feedback="Copied!"></div></button><button class="bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand" type="button"><span class="bx--snippet-btn--text" data-show-more-text="Show more" data-show-less-text="Show less">Show more</span><svg class="bx--icon-chevron--down" width="12" height="7" viewBox="0 0 12 7" aria-label="Show more icon"><title>Show more icon</title><path fill-rule="nonzero" d="M6.002 5.55L11.27 0l.726.685L6.003 7 0 .685.726 0z"></path></svg></button></div></div></p>
<p xmlns="http://www.w3.org/1999/xhtml">The Websockify proxy binds any registered tokens to its WebSocket URI, as shown here:</p>
<p><div class="ibm-codeblock"><h5 class="ibm-h5" id="listing4">Listing 4. Binding a registered token</h5><div class="bx--snippet bx--snippet--multi" data-code-snippet=""><div class="bx--snippet-container" aria-label="Code Snippet Text"><pre><code>
def addproxy_token(name, port, is_unix_socket=False):
    with open(os.path.join(WS_TOKENS_DIR, name), 'w') as f:
        """
        From python documentation base64.urlsafe_b64encode(s)
        substitutes - instead of + and  instead of / in the
        standard Base64 alphabet, BUT the result can still
        contain = which is not safe in a URL query component.
        So remove it when needed as base64 can work well without it.
        """
        name = base64.urlsafe_b64encode(name).rstrip('=')
        if is_unix_socket:
            f.write('%s: unix_socket:%s' % (name.encode('utf-8'), port))
        else:
            f.write('%s: localhost:%s' % (name.encode('utf-8'), port))
</code></pre></div><button data-copy-btn="" class="bx--snippet-button" type="button" aria-label="Copy code" tabindex="0"><svg class="bx--snippet__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M1 10H0V2C0 .9.9 0 2 0h8v1H2c-.6 0-1 .5-1 1v8z"></path><path d="M11 4.2V8h3.8L11 4.2zM15 9h-4c-.6 0-1-.4-1-1V4H4.5c-.3 0-.5.2-.5.5v10c0 .3.2.5.5.5h10c.3 0 .5-.2.5-.5V9zm-4-6c.1 0 .3.1.4.1l4.5 4.5c0 .1.1.3.1.4v6.5c0 .8-.7 1.5-1.5 1.5h-10c-.8 0-1.5-.7-1.5-1.5v-10C3 3.7 3.7 3 4.5 3H11z"></path></svg><div class="bx--btn--copy__feedback" data-feedback="Copied!"></div></button><button class="bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand" type="button"><span class="bx--snippet-btn--text" data-show-more-text="Show more" data-show-less-text="Show less">Show more</span><svg class="bx--icon-chevron--down" width="12" height="7" viewBox="0 0 12 7" aria-label="Show more icon"><title>Show more icon</title><path fill-rule="nonzero" d="M6.002 5.55L11.27 0l.726.685L6.003 7 0 .685.726 0z"></path></svg></button></div></div></p>
<p xmlns="http://www.w3.org/1999/xhtml">Below is the command to add a Websockify proxy entry called <code style="font-family:monospace;font-size:1rem">myUnixSocket</code>. This entry will proxy WebSocket connections to the Unix socket <code style="font-family:monospace;font-size:1rem">/run/my_socket</code>:</p>
<p><div class="ibm-codeblock"><div class="bx--snippet bx--snippet--multi" data-code-snippet=""><div class="bx--snippet-container" aria-label="Code Snippet Text"><pre><code>
add_proxy_token(‘myUnixSocket’, ‘/run/my_socket’, True)
</code></pre></div><button data-copy-btn="" class="bx--snippet-button" type="button" aria-label="Copy code" tabindex="0"><svg class="bx--snippet__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M1 10H0V2C0 .9.9 0 2 0h8v1H2c-.6 0-1 .5-1 1v8z"></path><path d="M11 4.2V8h3.8L11 4.2zM15 9h-4c-.6 0-1-.4-1-1V4H4.5c-.3 0-.5.2-.5.5v10c0 .3.2.5.5.5h10c.3 0 .5-.2.5-.5V9zm-4-6c.1 0 .3.1.4.1l4.5 4.5c0 .1.1.3.1.4v6.5c0 .8-.7 1.5-1.5 1.5h-10c-.8 0-1.5-.7-1.5-1.5v-10C3 3.7 3.7 3 4.5 3H11z"></path></svg><div class="bx--btn--copy__feedback" data-feedback="Copied!"></div></button><button class="bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand" type="button"><span class="bx--snippet-btn--text" data-show-more-text="Show more" data-show-less-text="Show less">Show more</span><svg class="bx--icon-chevron--down" width="12" height="7" viewBox="0 0 12 7" aria-label="Show more icon"><title>Show more icon</title><path fill-rule="nonzero" d="M6.002 5.55L11.27 0l.726.685L6.003 7 0 .685.726 0z"></path></svg></button></div></div></p>
<p xmlns="http://www.w3.org/1999/xhtml">In the UI, we open a WebSocket to the Unix socket using the following URI:</p>
<p><div class="ibm-codeblock"><div class="bx--snippet bx--snippet--multi" data-code-snippet=""><div class="bx--snippet-container" aria-label="Code Snippet Text"><pre><code>
wss://&lt;server_address>:&lt;port>/websockify?token=&lt;b64encodedtoken>
</code></pre></div><button data-copy-btn="" class="bx--snippet-button" type="button" aria-label="Copy code" tabindex="0"><svg class="bx--snippet__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M1 10H0V2C0 .9.9 0 2 0h8v1H2c-.6 0-1 .5-1 1v8z"></path><path d="M11 4.2V8h3.8L11 4.2zM15 9h-4c-.6 0-1-.4-1-1V4H4.5c-.3 0-.5.2-.5.5v10c0 .3.2.5.5.5h10c.3 0 .5-.2.5-.5V9zm-4-6c.1 0 .3.1.4.1l4.5 4.5c0 .1.1.3.1.4v6.5c0 .8-.7 1.5-1.5 1.5h-10c-.8 0-1.5-.7-1.5-1.5v-10C3 3.7 3.7 3 4.5 3H11z"></path></svg><div class="bx--btn--copy__feedback" data-feedback="Copied!"></div></button><button class="bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand" type="button"><span class="bx--snippet-btn--text" data-show-more-text="Show more" data-show-less-text="Show less">Show more</span><svg class="bx--icon-chevron--down" width="12" height="7" viewBox="0 0 12 7" aria-label="Show more icon"><title>Show more icon</title><path fill-rule="nonzero" d="M6.002 5.55L11.27 0l.726.685L6.003 7 0 .685.726 0z"></path></svg></button></div></div></p>
<p xmlns="http://www.w3.org/1999/xhtml">In the URI, <code style="font-family:monospace;font-size:1rem">b64encodedtoken</code> is the base64 value of the <code style="font-family:monospace;font-size:1rem">myUnixSocket</code> string without the <code style="font-family:monospace;font-size:1rem">=</code> character. For more about this configuration, see the <a href="https://github.com/kimchi-project/wok/blob/master/src/wok/websocket.py">WebSocket proxy module</a>.</p>
<h3 id="the-push-server">The push server</h3>
<p>There are two requirements for the push server:</p>
<ol>
<li>It must be able to handle multiple connections at the same time.</li>
<li>It must be able to broadcast the same message to all connected clients.</li>
</ol>
<p>For the purpose of this example, the push server will act as a broadcast agent. While the capability is there, we expect to receive no messages from the client side.</p>
<p>Listing 5 shows the relevant Python code for an initial version of the push server. (See <a href="https://github.com/kimchi-project/wok/blob/master/src/wok/pushserver.py">Project WoK on GitHub</a> for the final version of the <code style="font-family:monospace;font-size:1rem">pushserver</code> module.)</p>
<p><div class="ibm-codeblock"><h5 class="ibm-h5" id="listing5">Listing 5. WebSocket push server</h5><div class="bx--snippet bx--snippet--multi" data-code-snippet=""><div class="bx--snippet-container" aria-label="Code Snippet Text"><pre><code>
class PushServer(object):

    def init(self):
        self.setsocket_file()

        websocket.add_proxy_token(TOKEN_NAME, self.server_addr, True)

        self.connections = 
        self.server_running = True
        self.server_socket = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)
        self.server_socket.setsockopt(socket.SOL_SOCKET,
                                      socket.SO_REUSEADDR, 1)
        self.server_socket.bind(self.server_addr)
        self.server_socket.listen(10)
        wok_log.info('Push server created on address %s' % self.server_addr)

        self.connections.append(self.server_socket)
        cherrypy.engine.subscribe('stop', self.close_server, 1)

        server_loop = threading.Thread(target=self.listen)
        server_loop.setDaemon(True)
        server_loop.start()


    def listen(self):
        try:
            while self.server_running:
                read_ready, , _ = select.select(self.connections,
                                                 [], [], 1)
                for sock in read_ready:
                    if not self.server_running:
                        break

                    if sock == self.server_socket:

                        new_socket, addr = self.server_socket.accept()
                        self.connections.append(new_socket)
                    else:
                        try:
                            data = sock.recv(4096)
                        except:
                            try:
                                self.connections.remove(sock)
                            except ValueError:
                                pass

        except Exception as e:
            raise RuntimeError('Exception occurred in listen() of pushserver '
                               'module: %s' % e.message)


    def send_notification(self, message):
        for sock in self.connections:
            if sock != self.server_socket:
                    sock.send(message)
</code></pre></div><button data-copy-btn="" class="bx--snippet-button" type="button" aria-label="Copy code" tabindex="0"><svg class="bx--snippet__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M1 10H0V2C0 .9.9 0 2 0h8v1H2c-.6 0-1 .5-1 1v8z"></path><path d="M11 4.2V8h3.8L11 4.2zM15 9h-4c-.6 0-1-.4-1-1V4H4.5c-.3 0-.5.2-.5.5v10c0 .3.2.5.5.5h10c.3 0 .5-.2.5-.5V9zm-4-6c.1 0 .3.1.4.1l4.5 4.5c0 .1.1.3.1.4v6.5c0 .8-.7 1.5-1.5 1.5h-10c-.8 0-1.5-.7-1.5-1.5v-10C3 3.7 3.7 3 4.5 3H11z"></path></svg><div class="bx--btn--copy__feedback" data-feedback="Copied!"></div></button><button class="bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand" type="button"><span class="bx--snippet-btn--text" data-show-more-text="Show more" data-show-less-text="Show less">Show more</span><svg class="bx--icon-chevron--down" width="12" height="7" viewBox="0 0 12 7" aria-label="Show more icon"><title>Show more icon</title><path fill-rule="nonzero" d="M6.002 5.55L11.27 0l.726.685L6.003 7 0 .685.726 0z"></path></svg></button></div></div></p>
<p xmlns="http://www.w3.org/1999/xhtml">The <code style="font-family:monospace;font-size:1rem">__init__()</code> of the <code style="font-family:monospace;font-size:1rem">PushServer()</code> class initializes the Unix socket to listen for connections. We also add a token in the WebSocket proxy. This token will be used in the URI of the WebSocket connection by the frontend.</p>
<p>There are numerous ways to implement a server push architecture. For the purpose of a broadcasting server push implementation, I believe it is most intuitive to use a single listener thread (<code style="font-family:monospace;font-size:1rem">select.select()</code>) to control known connections. In this case, the <code style="font-family:monospace;font-size:1rem">listen()</code> method runs in a daemon thread and is responsible for managing existing connections. The <code style="font-family:monospace;font-size:1rem">select.select</code> method runs as a non-blocking function that returns when any socket from the <code style="font-family:monospace;font-size:1rem">self.connections</code> array is ready to be read, or after a one-second timeout. When a new connection is created, it is added in the <code style="font-family:monospace;font-size:1rem">self.connections</code> array. When a connection is closed, it is removed from the array.</p>
<p>The <code style="font-family:monospace;font-size:1rem">listen()</code> method can remove a socket from the array in one of two ways: either by detecting that the socket was closed in the <code style="font-family:monospace;font-size:1rem">except</code> block of the <code style="font-family:monospace;font-size:1rem">recv()</code> call, or by receiving a <code style="font-family:monospace;font-size:1rem">CLOSE</code> message. The <code style="font-family:monospace;font-size:1rem">send_notification()</code> method is responsible for broadcasting messages to clients that have subscribed to receive them. We use the <code style="font-family:monospace;font-size:1rem">except</code> block to close the socket connection when a client unsubscribes. We cannot use the <code style="font-family:monospace;font-size:1rem">listen()</code> alone to close a socket connection between the client and server, because doing so can lead to a broken pipe error in the <code style="font-family:monospace;font-size:1rem">send_notification()</code> method.</p>
<p>I&#8217;ll explain more about that in the next section.</p>
<h2 id="troubleshooting-the-websocket-frontend">Troubleshooting the WebSocket frontend</h2>
<p>Backend setup and configuration has been relatively easy, but coding the frontend will not be so simple. From deciding whether to open or close a browser connection to differences in how we handle certain APIs, the WebSocket frontend presents a few challenges. As we resolve those challenges, we&#8217;ll be required to revisit certain elements of the backend code.</p>
<p>Our first decision is whether to maintain a single WebSocket connection for all of the UI or setup multiple WebSocket connections to be opened on demand. We might first consider multiple, on-demand WebSocket connections. The idea is that a connection should only be opened when the UI is expecting a specific message from the backend—waiting for a certain task to complete, for example. If no asynchronous message is expected, no connection is needed. This spares resources from both the UI and the backend, but it comes at the cost of having to manage the lifecycle of each opened WebSocket.</p>
<p>The single, persistent WebSocket connection is more suitable for UIs that expect to receive a high volume of asynchronous messages from the server. The persistent connection is used as a notification stream, allowing any relevant UI code to listen and act on the messages being received.</p>
<p>Each solution has its place, and we will experiment with each one below. What is important is to use the approach that best suits your application.</p>
<h3 id="multiple-websocket-connections">Multiple WebSocket connections</h3>
<p>Opening and closing a WebSocket is a matter of calling a constructor to open and call the <code style="font-family:monospace;font-size:1rem">close()</code> method. Differences between browser behaviors such as page refresh can complicate things, however. Every time you open a WebSocket, a connection is made to the WebSocket proxy, and then to the actual push server on the backend. The connection is kept open until it is closed. Consider the following:</p>
<p><div class="ibm-codeblock"><h5 class="ibm-h5" id="listing6">Listing 6. Calling refreshInterface() on each received message</h5><div class="bx--snippet bx--snippet--multi" data-code-snippet=""><div class="bx--snippet-container" aria-label="Code Snippet Text"><pre><code>
notificationsWebSocket = new WebSocket(url, ['base64']);
notificationsWebSocket.onmessage = function(event) {
    refreshInterface();
};
</code></pre></div><button data-copy-btn="" class="bx--snippet-button" type="button" aria-label="Copy code" tabindex="0"><svg class="bx--snippet__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M1 10H0V2C0 .9.9 0 2 0h8v1H2c-.6 0-1 .5-1 1v8z"></path><path d="M11 4.2V8h3.8L11 4.2zM15 9h-4c-.6 0-1-.4-1-1V4H4.5c-.3 0-.5.2-.5.5v10c0 .3.2.5.5.5h10c.3 0 .5-.2.5-.5V9zm-4-6c.1 0 .3.1.4.1l4.5 4.5c0 .1.1.3.1.4v6.5c0 .8-.7 1.5-1.5 1.5h-10c-.8 0-1.5-.7-1.5-1.5v-10C3 3.7 3.7 3 4.5 3H11z"></path></svg><div class="bx--btn--copy__feedback" data-feedback="Copied!"></div></button><button class="bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand" type="button"><span class="bx--snippet-btn--text" data-show-more-text="Show more" data-show-less-text="Show less">Show more</span><svg class="bx--icon-chevron--down" width="12" height="7" viewBox="0 0 12 7" aria-label="Show more icon"><title>Show more icon</title><path fill-rule="nonzero" d="M6.002 5.55L11.27 0l.726.685L6.003 7 0 .685.726 0z"></path></svg></button></div></div></p>
<p xmlns="http://www.w3.org/1999/xhtml">In Listing 6, <code style="font-family:monospace;font-size:1rem">onmessage</code> is an event handler that is called every time a new message is received in the socket. The <code style="font-family:monospace;font-size:1rem">refreshInterface()</code> function is called when a message arrives. If multiple <code style="font-family:monospace;font-size:1rem">notificationsWebSocket</code> objects are left open, <code style="font-family:monospace;font-size:1rem">refreshInterface()</code> will be called multiple times as well.</p>
<p>Opening more WebSocket connections than we need is an obvious waste of resources for both the front- and backend. It also risks unintended behaviors. To work around these issues, we can avoid opening unnecessary WebSocket connections and close existing connections when they are no longer needed. Closing a WebSocket can be done manually or by the browser. In the browsers I’ve used for testing, Chrome and Firefox, both will close open WebSocket connections when the browser window is refreshed or closed, or when the domain is changed.</p>
<p>When a WebSocket is closed, two things happen:</p>
<ol>
<li>An event handler called <code style="font-family:monospace;font-size:1rem">onclose</code> is called to do any additional cleanup.</li>
<li>The closing side (in this case, the UI WebSocket) warns the other end by starting a closing handshake. In the process, a <em>close frame</em> is sent with the value of <a href="https://tools.ietf.org/html/rfc6455#page-9">0x8</a>. Upon receiving this frame, the backend is supposed to stop sending data and immediately close its side of the socket. This process happens regardless of what type of cleanup has been configured in the <code style="font-family:monospace;font-size:1rem">onclose</code> handler.</li>
</ol>
<p>Ideally, the <code style="font-family:monospace;font-size:1rem">onclose</code> handler is called and the push server receives the close frame. Unfortunately, that wasn&#8217;t what happened when I tested the implementation at this stage.</p>
<h4 id="websockify-proxy-and-the-close-frame">Websockify proxy and the close frame</h4>
<p>As of this writing, the Websockify proxy plugin (v0.8.0-2) does not forward a close frame to the Unix socket and on to the push server. Thus the connection in the UI socket may be closed, but the push server is unaware of it, and keeps its side of the connection open.</p>
<p>When the push server attempts to broadcasts a new message to all connections, including the closed socket, it will receive a broken pipe error. If not handled properly, this can lead to the push server being terminated. Here is the socket issuing a <code style="font-family:monospace;font-size:1rem">send_notification</code> message:</p>
<p><div class="ibm-codeblock"><h5 class="ibm-h5" id="listing7">Listing 7. send_notification leading to a broken pipe error</h5><div class="bx--snippet bx--snippet--multi" data-code-snippet=""><div class="bx--snippet-container" aria-label="Code Snippet Text"><pre><code>
    def send_notification(self, message):
        for sock in self.connections:
            if sock != self.server_socket:
                    sock.send(message)
</code></pre></div><button data-copy-btn="" class="bx--snippet-button" type="button" aria-label="Copy code" tabindex="0"><svg class="bx--snippet__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M1 10H0V2C0 .9.9 0 2 0h8v1H2c-.6 0-1 .5-1 1v8z"></path><path d="M11 4.2V8h3.8L11 4.2zM15 9h-4c-.6 0-1-.4-1-1V4H4.5c-.3 0-.5.2-.5.5v10c0 .3.2.5.5.5h10c.3 0 .5-.2.5-.5V9zm-4-6c.1 0 .3.1.4.1l4.5 4.5c0 .1.1.3.1.4v6.5c0 .8-.7 1.5-1.5 1.5h-10c-.8 0-1.5-.7-1.5-1.5v-10C3 3.7 3.7 3 4.5 3H11z"></path></svg><div class="bx--btn--copy__feedback" data-feedback="Copied!"></div></button><button class="bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand" type="button"><span class="bx--snippet-btn--text" data-show-more-text="Show more" data-show-less-text="Show less">Show more</span><svg class="bx--icon-chevron--down" width="12" height="7" viewBox="0 0 12 7" aria-label="Show more icon"><title>Show more icon</title><path fill-rule="nonzero" d="M6.002 5.55L11.27 0l.726.685L6.003 7 0 .685.726 0z"></path></svg></button></div></div></p>
<p xmlns="http://www.w3.org/1999/xhtml">One way of handling this situation would be to wrap the <code style="font-family:monospace;font-size:1rem">sock.send()</code> call in a <code style="font-family:monospace;font-size:1rem">try/except</code>, then deal with the broken pipe exception. An alternative would be to create a unique close handshake, using the <code style="font-family:monospace;font-size:1rem">onclose</code> event handler to send a message to the backend server. The push server side would then close its own socket connection, leaving the <code style="font-family:monospace;font-size:1rem">send_notification</code> method unchanged.</p>
<p>We&#8217;ll try that solution next.</p>
<h4 id="using-onclose-to-send-a-close-message">Using onclose to send a close message</h4>
<p>The <code style="font-family:monospace;font-size:1rem">onclose</code> event handler will be called just before a WebSocket connection is terminated. However the connection is still alive at this point. Our idea is to allow for a clean end-of-connection by sending a close message to the push server, so that it knows the socket will be closed on the frontend. Basically, we’re emulating the close frame&#8217;s role in the closing handshake.</p>
<p>Listing 8 shows the WebSocket sending a <code style="font-family:monospace;font-size:1rem">CLOSE</code> message to the push server just before closing the connection:</p>
<p><div class="ibm-codeblock"><h5 class="ibm-h5" id="listing8">Listing 8. Sending a CLOSE message in the onclose event</h5><div class="bx--snippet bx--snippet--multi" data-code-snippet=""><div class="bx--snippet-container" aria-label="Code Snippet Text"><pre><code>
notificationsWebSocket = new WebSocket(url, ['base64']);
(...)
notificationsWebSocket.onclose = function() {
    notificationsWebSocket.send(window.btoa(‘CLOSE’));
};
</code></pre></div><button data-copy-btn="" class="bx--snippet-button" type="button" aria-label="Copy code" tabindex="0"><svg class="bx--snippet__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M1 10H0V2C0 .9.9 0 2 0h8v1H2c-.6 0-1 .5-1 1v8z"></path><path d="M11 4.2V8h3.8L11 4.2zM15 9h-4c-.6 0-1-.4-1-1V4H4.5c-.3 0-.5.2-.5.5v10c0 .3.2.5.5.5h10c.3 0 .5-.2.5-.5V9zm-4-6c.1 0 .3.1.4.1l4.5 4.5c0 .1.1.3.1.4v6.5c0 .8-.7 1.5-1.5 1.5h-10c-.8 0-1.5-.7-1.5-1.5v-10C3 3.7 3.7 3 4.5 3H11z"></path></svg><div class="bx--btn--copy__feedback" data-feedback="Copied!"></div></button><button class="bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand" type="button"><span class="bx--snippet-btn--text" data-show-more-text="Show more" data-show-less-text="Show less">Show more</span><svg class="bx--icon-chevron--down" width="12" height="7" viewBox="0 0 12 7" aria-label="Show more icon"><title>Show more icon</title><path fill-rule="nonzero" d="M6.002 5.55L11.27 0l.726.685L6.003 7 0 .685.726 0z"></path></svg></button></div></div></p>
<p xmlns="http://www.w3.org/1999/xhtml">In the push server, we listen to all incoming messages from the UI to see if the <code style="font-family:monospace;font-size:1rem">CLOSE</code> message has been received. If it has, we close the socket immediately:</p>
<p><div class="ibm-codeblock"><h5 class="ibm-h5" id="listing9">Listing 9. Push server response to CLOSE</h5><div class="bx--snippet bx--snippet--multi" data-code-snippet=""><div class="bx--snippet-container" aria-label="Code Snippet Text"><pre><code>
    def listen(self):
        try:
            while self.serverrunning:
                read_ready, , _ = select.select(self.connections,
                                                 [], [], 1)
                for sock in read_ready:
                    if not self.server_running:
                        break

                    if sock == self.server_socket:

                        new_socket, addr = self.server_socket.accept()
                        self.connections.append(new_socket)
                    else:
                        try:
                            data = sock.recv(4096)
                        except:
                            try:
                                self.connections.remove(sock)
                            except ValueError:
                                pass

                            continue
                        if data and data == 'CLOSE':
                            try:
                                self.connections.remove(sock)
                            except ValueError:
                                pass
                            sock.close()
</code></pre></div><button data-copy-btn="" class="bx--snippet-button" type="button" aria-label="Copy code" tabindex="0"><svg class="bx--snippet__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M1 10H0V2C0 .9.9 0 2 0h8v1H2c-.6 0-1 .5-1 1v8z"></path><path d="M11 4.2V8h3.8L11 4.2zM15 9h-4c-.6 0-1-.4-1-1V4H4.5c-.3 0-.5.2-.5.5v10c0 .3.2.5.5.5h10c.3 0 .5-.2.5-.5V9zm-4-6c.1 0 .3.1.4.1l4.5 4.5c0 .1.1.3.1.4v6.5c0 .8-.7 1.5-1.5 1.5h-10c-.8 0-1.5-.7-1.5-1.5v-10C3 3.7 3.7 3 4.5 3H11z"></path></svg><div class="bx--btn--copy__feedback" data-feedback="Copied!"></div></button><button class="bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand" type="button"><span class="bx--snippet-btn--text" data-show-more-text="Show more" data-show-less-text="Show less">Show more</span><svg class="bx--icon-chevron--down" width="12" height="7" viewBox="0 0 12 7" aria-label="Show more icon"><title>Show more icon</title><path fill-rule="nonzero" d="M6.002 5.55L11.27 0l.726.685L6.003 7 0 .685.726 0z"></path></svg></button></div></div></p>
<p xmlns="http://www.w3.org/1999/xhtml">Calling <code style="font-family:monospace;font-size:1rem">onclose</code> before the WebSocket is closed and the <code style="font-family:monospace;font-size:1rem">CLOSE</code> message is sent should prevent broken pipe errors in the <code style="font-family:monospace;font-size:1rem">send_notification</code> routine. Unfortunately, while <code style="font-family:monospace;font-size:1rem">onclose</code> works well in Firefox, testing shows that we&#8217;re still geting broken pipe errors in the <code style="font-family:monospace;font-size:1rem">send_notification</code> method when we open the application in Chrome. This is due to an unresolved <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=93698">issue</a> in Google Chrome.</p>
<h3 id="the-single-persistent-websocket-connection">The single, persistent WebSocket connection</h3>
<p>Issues with <code style="font-family:monospace;font-size:1rem">onclose</code> and the close frame push us toward the single, persistent WebSocket connection. A single connection that will be closed only when the browser leaves the page (either by closing the window, reloading, or going to another URL) requires only that the push server closes the connection when a broken pipe occurs. A centralized connection would be easier to maintain in Project WoK, and WoK plugins would relieve us from implementing a WebSocket strategy from scratch.</p>
<p>Listing 10 shows a modified <code style="font-family:monospace;font-size:1rem">send_notification</code> message. Note that it handles the broken pipe error by removing the socket from the valid connection list and then closing it:</p>
<p><div class="ibm-codeblock"><h5 class="ibm-h5" id="listing10">Listing 10. send_notification for a single, persistent connection</h5><div class="bx--snippet bx--snippet--multi" data-code-snippet=""><div class="bx--snippet-container" aria-label="Code Snippet Text"><pre><code>
        def send_notification(self, message):
        for sock in self.connections:
            if sock != self.server_socket:
                try:
                    sock.send(message)
                except IOError as e:
                    if 'Broken pipe' in str(e):
                        sock.close()
                        try:
                            self.connections.remove(sock)
                        except ValueError:
                            pass
</code></pre></div><button data-copy-btn="" class="bx--snippet-button" type="button" aria-label="Copy code" tabindex="0"><svg class="bx--snippet__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M1 10H0V2C0 .9.9 0 2 0h8v1H2c-.6 0-1 .5-1 1v8z"></path><path d="M11 4.2V8h3.8L11 4.2zM15 9h-4c-.6 0-1-.4-1-1V4H4.5c-.3 0-.5.2-.5.5v10c0 .3.2.5.5.5h10c.3 0 .5-.2.5-.5V9zm-4-6c.1 0 .3.1.4.1l4.5 4.5c0 .1.1.3.1.4v6.5c0 .8-.7 1.5-1.5 1.5h-10c-.8 0-1.5-.7-1.5-1.5v-10C3 3.7 3.7 3 4.5 3H11z"></path></svg><div class="bx--btn--copy__feedback" data-feedback="Copied!"></div></button><button class="bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand" type="button"><span class="bx--snippet-btn--text" data-show-more-text="Show more" data-show-less-text="Show less">Show more</span><svg class="bx--icon-chevron--down" width="12" height="7" viewBox="0 0 12 7" aria-label="Show more icon"><title>Show more icon</title><path fill-rule="nonzero" d="M6.002 5.55L11.27 0l.726.685L6.003 7 0 .685.726 0z"></path></svg></button></div></div></p>
<h4 id="configuring-the-heartbeat" xmlns="http://www.w3.org/1999/xhtml">Configuring the heartbeat</h4>
<p>In a multiple connections strategy, you open a connection, use it, and then close it immediately. A single, persistent connection should be kept open indefinitely, even if nothing is being sent. However, testing in Chrome and Firefox shows that the WebSocket connection times out after a period of being idle, and the connection is terminated.</p>
<p>To avoid a browser timeout, we implement a simple heartbeat message to be sent periodically to the push server. This message keeps the WebSocket connection alive—the push server doesn&#8217;t need to respond to it. The default timeout seems to be 300 seconds, but we can&#8217;t assume all browsers implement the same timeout. To be safe, we set the heartbeat message to a 30-second interval, as shown in Listing 11:</p>
<p><div class="ibm-codeblock"><h5 class="ibm-h5" id="listing11">Listing 11. Timeout interval</h5><div class="bx--snippet bx--snippet--multi" data-code-snippet=""><div class="bx--snippet-container" aria-label="Code Snippet Text"><pre><code>
    notificationsWebSocket = new WebSocket(url, ['base64']);
    var heartbeat = setInterval(function() {
        notificationsWebSocket.send(window.btoa('heartbeat'));
    }, 30000);
</code></pre></div><button data-copy-btn="" class="bx--snippet-button" type="button" aria-label="Copy code" tabindex="0"><svg class="bx--snippet__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M1 10H0V2C0 .9.9 0 2 0h8v1H2c-.6 0-1 .5-1 1v8z"></path><path d="M11 4.2V8h3.8L11 4.2zM15 9h-4c-.6 0-1-.4-1-1V4H4.5c-.3 0-.5.2-.5.5v10c0 .3.2.5.5.5h10c.3 0 .5-.2.5-.5V9zm-4-6c.1 0 .3.1.4.1l4.5 4.5c0 .1.1.3.1.4v6.5c0 .8-.7 1.5-1.5 1.5h-10c-.8 0-1.5-.7-1.5-1.5v-10C3 3.7 3.7 3 4.5 3H11z"></path></svg><div class="bx--btn--copy__feedback" data-feedback="Copied!"></div></button><button class="bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand" type="button"><span class="bx--snippet-btn--text" data-show-more-text="Show more" data-show-less-text="Show less">Show more</span><svg class="bx--icon-chevron--down" width="12" height="7" viewBox="0 0 12 7" aria-label="Show more icon"><title>Show more icon</title><path fill-rule="nonzero" d="M6.002 5.55L11.27 0l.726.685L6.003 7 0 .685.726 0z"></path></svg></button></div></div></p>
<p xmlns="http://www.w3.org/1999/xhtml">This simple timeout will keep the WebSocket connection alive, and will not flood the push server with heartbeat messages.</p>
<h4 id="adding-listeners">Adding listeners</h4>
<p>With a single permanent connection established, we can implement a straightforward listener strategy to allow any other UI code inside our example application to listen to messages. Here&#8217;s the design:</p>
<ol>
<li>A listener is bound to a specific message format. Our example application sends many notification messages. Message binding allows us to register a listener for specific ones only.</li>
<li>Upon receiving a message from the push server, the main WebSocket channel verifies its content and calls all listeners bound to that message.</li>
<li>The WebSocket channel initiates listener cleanup. Listeners must be deprecated when a URI changes. For example, a listener on the <strong>Activity Log</strong> tab in the URI <code style="font-family:monospace;font-size:1rem">/#tabs/user-log</code> should be deprecated when the user browses to the <strong>Settings</strong> tab in the <code style="font-family:monospace;font-size:1rem">/#tabs/settings</code> URI. Cleanup is bound to the <code style="font-family:monospace;font-size:1rem">hashchange</code> event, which is triggered every time the URL (<code style="font-family:monospace;font-size:1rem">location.hash</code>) changes. Since we don’t need to do this process more than once, we can set the <code style="font-family:monospace;font-size:1rem">$.one()’ jQuery</code> call to execute it just once.</li>
</ol>
<p>Here is the code that handles listeners in the example application:</p>
<p><div class="ibm-codeblock"><h5 class="ibm-h5" id="listing12">Listing 12. Listener config for Project WoK</h5><div class="bx--snippet bx--snippet--multi" data-code-snippet=""><div class="bx--snippet-container" aria-label="Code Snippet Text"><pre><code>
wok.notificationListeners = {};
wok.addNotificationListener = function(msg, func) {
    var listenerArray = wok.notificationListeners[msg];
    if (listenerArray == undefined) {
        listenerArray = [];
    }
    listenerArray.push(func);
    wok.notificationListeners[msg] = listenerArray;
    $(window).one("hashchange", function() {
        var listenerArray = wok.notificationListeners[msg];
        var del_index = listenerArray.indexOf(func);
        listenerArray.splice(del_index, 1);
        wok.notificationListeners[msg] = listenerArray;
    });
};
</code></pre></div><button data-copy-btn="" class="bx--snippet-button" type="button" aria-label="Copy code" tabindex="0"><svg class="bx--snippet__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M1 10H0V2C0 .9.9 0 2 0h8v1H2c-.6 0-1 .5-1 1v8z"></path><path d="M11 4.2V8h3.8L11 4.2zM15 9h-4c-.6 0-1-.4-1-1V4H4.5c-.3 0-.5.2-.5.5v10c0 .3.2.5.5.5h10c.3 0 .5-.2.5-.5V9zm-4-6c.1 0 .3.1.4.1l4.5 4.5c0 .1.1.3.1.4v6.5c0 .8-.7 1.5-1.5 1.5h-10c-.8 0-1.5-.7-1.5-1.5v-10C3 3.7 3.7 3 4.5 3H11z"></path></svg><div class="bx--btn--copy__feedback" data-feedback="Copied!"></div></button><button class="bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand" type="button"><span class="bx--snippet-btn--text" data-show-more-text="Show more" data-show-less-text="Show less">Show more</span><svg class="bx--icon-chevron--down" width="12" height="7" viewBox="0 0 12 7" aria-label="Show more icon"><title>Show more icon</title><path fill-rule="nonzero" d="M6.002 5.55L11.27 0l.726.685L6.003 7 0 .685.726 0z"></path></svg></button></div></div></p>
<p xmlns="http://www.w3.org/1999/xhtml">And this is how messages are sent to each relevant listener:</p>
<p><div class="ibm-codeblock"><h5 class="ibm-h5" id="listing13">Listing 13. Listener notification</h5><div class="bx--snippet bx--snippet--multi" data-code-snippet=""><div class="bx--snippet-container" aria-label="Code Snippet Text"><pre><code>
wok.startNotificationWebSocket = function () {
    wok.notificationsWebSocket = new WebSocket(url, ['base64']);
    wok.notificationsWebSocket.onmessage = function(event) {
        var message  = window.atob(event.data);
         if (message === "") {
                continue;
        }
            
        var listenerArray = wok.notificationListeners[message];
        if (listenerArray == undefined) {
            continue;
        }
        for (var i = 0; i &lt; listenerArray.length; i++) {
            listenerArrayi;
        }
    }
 };
</code></pre></div><button data-copy-btn="" class="bx--snippet-button" type="button" aria-label="Copy code" tabindex="0"><svg class="bx--snippet__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M1 10H0V2C0 .9.9 0 2 0h8v1H2c-.6 0-1 .5-1 1v8z"></path><path d="M11 4.2V8h3.8L11 4.2zM15 9h-4c-.6 0-1-.4-1-1V4H4.5c-.3 0-.5.2-.5.5v10c0 .3.2.5.5.5h10c.3 0 .5-.2.5-.5V9zm-4-6c.1 0 .3.1.4.1l4.5 4.5c0 .1.1.3.1.4v6.5c0 .8-.7 1.5-1.5 1.5h-10c-.8 0-1.5-.7-1.5-1.5v-10C3 3.7 3.7 3 4.5 3H11z"></path></svg><div class="bx--btn--copy__feedback" data-feedback="Copied!"></div></button><button class="bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand" type="button"><span class="bx--snippet-btn--text" data-show-more-text="Show more" data-show-less-text="Show less">Show more</span><svg class="bx--icon-chevron--down" width="12" height="7" viewBox="0 0 12 7" aria-label="Show more icon"><title>Show more icon</title><path fill-rule="nonzero" d="M6.002 5.55L11.27 0l.726.685L6.003 7 0 .685.726 0z"></path></svg></button></div></div></p>
<p xmlns="http://www.w3.org/1999/xhtml">With that, we&#8217;re very close to being done. But there is one more issue we need to resolve first.</p>
<h3 id="merged-messages">Merged messages</h3>
<p>While the single connection works, the current implementation makes an invalid assumption about how messages will be received on the frontend. What if the push server sends two messages in quick succession, <code style="font-family:monospace;font-size:1rem">message1</code> and then <code style="font-family:monospace;font-size:1rem">message2</code>? The code expects that the <code style="font-family:monospace;font-size:1rem">onmessage</code> event will be triggered twice with content to be read in the WebSocket, but that&#8217;s not necessarily true. In fact, it&#8217;s more likely that the message received will be <code style="font-family:monospace;font-size:1rem">message1message2</code>—a <em>merged message</em>.</p>
<p>Merging messages is common TCP socket behavior: when two or more messages are sent in quick succession, the receiving socket will queue them and the <code style="font-family:monospace;font-size:1rem">onmessage</code> event will be triggered only once for them all. If we haven&#8217;t planned for it, this behavior will break our code. The solution is to define a messaging format that lets the application determine where one message ends and another begins.</p>
<p>One popular option is the <a href="https://en.wikipedia.org/wiki/Type-length-value">TLV format</a>, standing for Type-Length-Value. In this format the message contains three fields: type, length, and value, in that order. Type and length are of fixed size, and value has a variable size declared by the <em>length</em> field. The <em>type</em> field can be used to distinguish message types such as string, boolean, binary, or integer. It can also be use for application-specific purposes, such as warning message, information message, error message, and so on.</p>
<p>For our purposes, however, TLV is overkill. Our messages will always be strings, so there is no need for a <em>type</em> field. To solve the concatenation of the messages, we could add a fixed-length field declaring how many <code style="font-family:monospace;font-size:1rem">chars</code> belong to the message. An even simpler approach would be to add an end-of-message marker to every message being sent. After receiving a message buffer, the frontend parses it using the message marker, splitting it into individual frontend messages.</p>
<p>Listing 14 shows the <code style="font-family:monospace;font-size:1rem">send_notification</code> method modified with an end-of-message marker:</p>
<p><div class="ibm-codeblock"><h5 class="ibm-h5" id="listing14">Listing 14. End-of-message marker in send_notification</h5><div class="bx--snippet bx--snippet--multi" data-code-snippet=""><div class="bx--snippet-container" aria-label="Code Snippet Text"><pre><code>
END_OF_MESSAGE_MARKER = '//EOM//'

    def send_notification(self, message):
        message += END_OF_MESSAGE_MARKER
        for sock in self.connections:
            if sock != self.server_socket:
                try:
                    sock.send(message)
                except IOError as e:
                    if 'Broken pipe' in str(e):
                        sock.close()
                        try:
                            self.connections.remove(sock)
                        except ValueError:
                            pass
</code></pre></div><button data-copy-btn="" class="bx--snippet-button" type="button" aria-label="Copy code" tabindex="0"><svg class="bx--snippet__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M1 10H0V2C0 .9.9 0 2 0h8v1H2c-.6 0-1 .5-1 1v8z"></path><path d="M11 4.2V8h3.8L11 4.2zM15 9h-4c-.6 0-1-.4-1-1V4H4.5c-.3 0-.5.2-.5.5v10c0 .3.2.5.5.5h10c.3 0 .5-.2.5-.5V9zm-4-6c.1 0 .3.1.4.1l4.5 4.5c0 .1.1.3.1.4v6.5c0 .8-.7 1.5-1.5 1.5h-10c-.8 0-1.5-.7-1.5-1.5v-10C3 3.7 3.7 3 4.5 3H11z"></path></svg><div class="bx--btn--copy__feedback" data-feedback="Copied!"></div></button><button class="bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand" type="button"><span class="bx--snippet-btn--text" data-show-more-text="Show more" data-show-less-text="Show less">Show more</span><svg class="bx--icon-chevron--down" width="12" height="7" viewBox="0 0 12 7" aria-label="Show more icon"><title>Show more icon</title><path fill-rule="nonzero" d="M6.002 5.55L11.27 0l.726.685L6.003 7 0 .685.726 0z"></path></svg></button></div></div></p>
<p xmlns="http://www.w3.org/1999/xhtml">Note the <code style="font-family:monospace;font-size:1rem">//EOM//</code> sequence in Listing 14. Any sequence can be used to denote the end of the message, as long as it isn&#8217;t something that could be included in a valid message—like <em>end</em>.</p>
<p>Listing 15 shows the finished frontend code after adding the end-of-message parsing. See <a href="https://github.com/kimchi-project/wok/blob/master/ui/js/src/wok.main.js">Project WoK</a> for the complete source.</p>
<p><div class="ibm-codeblock"><h5 class="ibm-h5" id="listing15">Listing 15. The WebSocket frontend</h5><div class="bx--snippet bx--snippet--multi" data-code-snippet=""><div class="bx--snippet-container" aria-label="Code Snippet Text"><pre><code>
wok.notificationListeners = {};
wok.addNotificationListener = function(msg, func) {
    var listenerArray = wok.notificationListeners[msg];
    if (listenerArray == undefined) {
        listenerArray = [];
    }
    listenerArray.push(func);
    wok.notificationListeners[msg] = listenerArray;
    $(window).one("hashchange", function() {
        var listenerArray = wok.notificationListeners[msg];
        var del_index = listenerArray.indexOf(func);
        listenerArray.splice(del_index, 1);
        wok.notificationListeners[msg] = listenerArray;
    });
};

wok.notificationsWebSocket = undefined;
wok.startNotificationWebSocket = function () {
    var addr = window.location.hostname + ':' + window.location.port;
    var token = wok.urlSafeB64Encode('woknotifications').replace(/=*$/g, "");
    var url = 'wss://' + addr + '/websockify?token=' + token;
    wok.notificationsWebSocket = new WebSocket(url, ['base64']);

    wok.notificationsWebSocket.onmessage = function(event) {
        var buffer_rcv = window.atob(event.data);
        var messages = buffer_rcv.split("//EOM//");
        for (var i = 0; i &lt; messages.length; i++) {
            if (messages[i] === "") {
                continue;
            }
            var listenerArray = wok.notificationListeners[messages[i]];
            if (listenerArray == undefined) {
                continue;
            }
            for (var j = 0; j &lt; listenerArray.length; j++) {
                listenerArrayj;
            }
        }
    };

    var heartbeat = setInterval(function() {
        wok.notificationsWebSocket.send(window.btoa('heartbeat'));
    }, 30000);

};
</code></pre></div><button data-copy-btn="" class="bx--snippet-button" type="button" aria-label="Copy code" tabindex="0"><svg class="bx--snippet__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M1 10H0V2C0 .9.9 0 2 0h8v1H2c-.6 0-1 .5-1 1v8z"></path><path d="M11 4.2V8h3.8L11 4.2zM15 9h-4c-.6 0-1-.4-1-1V4H4.5c-.3 0-.5.2-.5.5v10c0 .3.2.5.5.5h10c.3 0 .5-.2.5-.5V9zm-4-6c.1 0 .3.1.4.1l4.5 4.5c0 .1.1.3.1.4v6.5c0 .8-.7 1.5-1.5 1.5h-10c-.8 0-1.5-.7-1.5-1.5v-10C3 3.7 3.7 3 4.5 3H11z"></path></svg><div class="bx--btn--copy__feedback" data-feedback="Copied!"></div></button><button class="bx--btn bx--btn--ghost bx--btn--sm bx--snippet-btn--expand" type="button"><span class="bx--snippet-btn--text" data-show-more-text="Show more" data-show-less-text="Show less">Show more</span><svg class="bx--icon-chevron--down" width="12" height="7" viewBox="0 0 12 7" aria-label="Show more icon"><title>Show more icon</title><path fill-rule="nonzero" d="M6.002 5.55L11.27 0l.726.685L6.003 7 0 .685.726 0z"></path></svg></button></div></div></p>
<h2 id="conclusion" xmlns="http://www.w3.org/1999/xhtml">Conclusion</h2>
<p>Server-sent events is an elegant and simple solution for web applications that only need to be able to stream asynchronous server messages to the client. Being a half-duplex HTTP solution, SSE does not allow the client to stream messages back to the server. Moreover, at the time of this writing, SSE is not supported by any Microsoft browser. Whether this is a dealbreaker depends on your application&#8217;s target audience.</p>
<p>WebSocket is more complex and demanding, but the full-duplex TCP connection makes it useful for a wider range of application scenarios. WebSocket is supported by most modern web frameworks, and is compatible with all major web and mobile browsers. While not demonstrated, it&#8217;s possible to use a server framework like Tornado, which would allow you to quickly configure the push server rather than coding it from scratch.</p>
<p>SSE is a simpler and faster solution, but it isn&#8217;t extensible. If your web application requirements were to change (for example, if you determined the frontend should interact with the backend) you would need to refactor your application using WebSocket. WebSocket presents more upfront work, but is a more versatile and extensible framework. It is better suited to complex applications that will add new features over time.</p>                    <footer class="code--entry-footer"></footer>        </section>
      </div>
    </div>
    <div class="cpt-aside">
      <div id="dockable2" class="fixHeader2">
        <div class="cpt-aside__wrap">
          <nav class="cpt-social" role="navigation" aria-label="Social sharing">
	            <h5>Social</h5>
	            <ul>
	              <li>
									<a onclick="return ibmcode.socialpopup(this);" target="_blank" class="ibm-facebook-encircled-link" href="http://www.facebook.com/sharer.php?u=https%3A%2F%2Fdeveloper.ibm.com%2Farticles%2Fwa-http-server-push-with-websocket-sse%2F&amp;t=HTTP+server+push+with+WebSocket+and+SSE" data-id="facebook">
										<i class="ibm-access">Facebook</i>
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
		                  <title>Facebook</title>
		                  <path d="M22.675 0h-21.35c-.732 0-1.325.593-1.325 1.325v21.351c0 .731.593 1.324 1.325 1.324h11.495v-9.294h-3.128v-3.622h3.128v-2.671c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.795.143v3.24l-1.918.001c-1.504 0-1.795.715-1.795 1.763v2.313h3.587l-.467 3.622h-3.12v9.293h6.116c.73 0 1.323-.593 1.323-1.325v-21.35c0-.732-.593-1.325-1.325-1.325z"/>
		                </svg>
									</a>
								</li>
								<li>
									<a onclick="return ibmcode.socialpopup(this);" target="_blank" class="ibm-twitter-encircled-link" href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fdeveloper.ibm.com%2Farticles%2Fwa-http-server-push-with-websocket-sse%2F&amp;text=HTTP+server+push+with+WebSocket+and+SSE" data-id="twitter">
										<i class="ibm-access">Twitter</i>
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
											<title>Twitter</title>
											<path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/>
										</svg>
									</a>
								</li>
								<li>
									<a onclick="return ibmcode.socialpopup(this);" target="_blank" class="ibm-linkedin-encircled-link" href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fdeveloper.ibm.com%2Farticles%2Fwa-http-server-push-with-websocket-sse%2F&amp;title=HTTP+server+push+with+WebSocket+and+SSE" data-id="linkedin">
										<i class="ibm-access">Linked In</i>
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
											<title>LinkedIn</title>
											<path d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z"/>
										</svg>
									</a>
								</li>
								<li>
									<a onclick="return ibmcode.socialpopup(this);" target="_blank" class="ibm-googleplus-encircled-link" href="https://plus.google.com/share?url=https%3A%2F%2Fdeveloper.ibm.com%2Farticles%2Fwa-http-server-push-with-websocket-sse%2F&amp;t=HTTP+server+push+with+WebSocket+and+SSE" data-id="googleplus">
									  <i class="ibm-access">Google+</i>
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
											<title>Google+</title>
											<path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-10.333 16.667c-2.581 0-4.667-2.087-4.667-4.667s2.086-4.667 4.667-4.667c1.26 0 2.313.46 3.127 1.22l-1.267 1.22c-.347-.333-.954-.72-1.86-.72-1.593 0-2.893 1.32-2.893 2.947s1.3 2.947 2.893 2.947c1.847 0 2.54-1.327 2.647-2.013h-2.647v-1.6h4.406c.041.233.074.467.074.773-.001 2.666-1.787 4.56-4.48 4.56zm11.333-4h-2v2h-1.334v-2h-2v-1.333h2v-2h1.334v2h2v1.333z"/>
										</svg>
									</a>
								</li>
							</ul>
						</nav><nav class="cpt-contentNav"><h5>Contents</h5><ul>
<li><a href="#the-limits-of-request-response">The limits of request-response</a></li>
<li><a href="#comparing-websocket-and-sse">Comparing WebSocket and SSE</a></li>
<ul>
<li><a href="#browser-support">Browser support</a></li>
<li><a href="#development-effort">Development effort</a></li>
</ul>
<li><a href="#developing-an-sse-application">Developing an SSE application</a></li>
<ul>
<li><a href="#the-sse-frontend">The SSE frontend</a></li>
<li><a href="#the-sse-backend">The SSE backend</a></li>
</ul>
<li><a href="#developing-a-websocket-application">Developing a WebSocket application</a></li>
<ul>
<li><a href="#websockify-proxy">Websockify proxy</a></li>
<li><a href="#the-push-server">The push server</a></li>
</ul>
<li><a href="#troubleshooting-the-websocket-frontend">Troubleshooting the WebSocket frontend</a></li>
<ul>
<li><a href="#multiple-websocket-connections">Multiple WebSocket connections</a></li>
<ul>
<li><a href="#websockify-proxy-and-the-close-frame">Websockify proxy and the close frame</a></li>
<li><a href="#using-onclose-to-send-a-close-message">Using onclose to send a close message</a></li>
</ul>
<li><a href="#the-single-persistent-websocket-connection">The single, persistent WebSocket connection</a></li>
<ul>
<li><a href="#configuring-the-heartbeat">Configuring the heartbeat</a></li>
<li><a href="#adding-listeners">Adding listeners</a></li>
</ul>
<li><a href="#merged-messages">Merged messages</a></li>
</ul>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</nav><nav class="cpt-contentNav"><h5>Resources</h5>                <ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers" target="_blank">Writing WebSocket servers</a></li><li><a href="https://www.ibm.com/developerworks/ibmi/library/i-running-websocket-applications-on-ibmi-trs/index.html" target="_blank">Running WebSocket applications on IBM i</a></li><li><a href="http://caniuse.com/#search=EventSource" target="_blank">Web and mobile browser support for Server-Sent Events</a></li><li><a href="http://caniuse.com/#feat=websockets" target="_blank">Web and mobile browser support for the WebSocket protocol</a></li>
                    </ul></nav>        </div>
      </div>
    </div>
    
  </div>
</div>
<!-- end new layout -->
<div class="cpt__related_content"><h4><span>Related content</span></h4><div class="bx--grid"><div id="ftrelated" class="bx--row" data-widget="setsameheight" data-always="true" data-items=".ibm--card__body"><div class="bx--col-xs-12 bx--col-md-4"><div class="ibm--card">
          <a class="ibm--card__block_link" href="/tutorials/x-andbene1/">
            <div class="ibm--card__body">
              <h5 class="ibm--card__type">
                Tutorial
                <span class="ibm--card__date">Mar 21, 2019</span>
              </h5>
              <h3 class="ibm--card__title"><span>Explore the benefits of JSON and XML in Android applications</span></h3>
              <p class="ibm--card__excerpt">Explore techniques for handling two of the most common data formats used on the Internet, XML and JavaScript Object Notation&hellip;</p>
            </div>
            <div class="ibm--card__bottom"><p class="cpt-byline__categories"><span class="bx--tag bx--tag--category">Mobile development</span><span class="bx--tag bx--tag--category">Web development</span></p></div>
          </a>
        </div></div><div class="bx--col-xs-12 bx--col-md-4"><div class="ibm--card">
          <a class="ibm--card__block_link" href="/tutorials/x-andbene2/">
            <div class="ibm--card__body">
              <h5 class="ibm--card__type">
                Tutorial
                <span class="ibm--card__date">Mar 21, 2019</span>
              </h5>
              <h3 class="ibm--card__title"><span>Deliver hybrid Android applications with JSON</span></h3>
              <p class="ibm--card__excerpt">This two-part article series examines techniques for handling two of the most common data formats found on the Internet today,&hellip;</p>
            </div>
            <div class="ibm--card__bottom"><p class="cpt-byline__categories"><span class="bx--tag bx--tag--category">Mobile development</span><span class="bx--tag bx--tag--category">Web development</span></p></div>
          </a>
        </div></div><div class="bx--col-xs-12 bx--col-md-4"><div class="ibm--card ibm--card__ibmcode_events">
          <a class="ibm--card__block_link" href="/events/codestock-2019-knoxville-knoxville-4-12-2019-4-13-2019/" class="">
            <div class="ibm--card__body">
              <p class="ibm--card__type">Conference</p>
              <h3 class="ibm--card__title">CodeStock 2019 - Knoxville</h3>
              <p class="ibm--card__date">
                <svg version="1.1" x="0px" y="0px" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve">
<g>
	<g>
		<g>
			<path class="st0" d="M15.6,4.5c0-1.4-1.1-2.5-2.5-2.5s-2.5,1.1-2.5,2.5v1.2h5V4.5z"/>
		</g>
		<g>
			<path class="st0" d="M38.8,4.5c0-1.4-1.1-2.5-2.5-2.5s-2.5,1.1-2.5,2.5v1.2h5V4.5z"/>
		</g>
		<g>
			<path class="st0" d="M44.1,5.7h-5.2v3.1c0,1.4-1.1,2.5-2.5,2.5s-2.5-1.1-2.5-2.5V5.7H15.6v3.1c0,1.4-1.1,2.5-2.5,2.5
				s-2.5-1.1-2.5-2.5V5.7H5.3c-1.1,0-2,0.9-2,2v34.6c0,1.1,0.9,2,2,2h38.7c1.1,0,2-0.9,2-2V7.7C46.1,6.6,45.2,5.7,44.1,5.7z
				 M42.1,40.3H7.3V15.4h34.7V40.3z"/>
		</g>
	</g>
	<g>
		<path class="st0" d="M22.5,36.3L22.5,36.3c-0.5,0-1-0.2-1.4-0.6l-7-7c-0.8-0.8-0.8-2,0-2.8s2-0.8,2.8,0l5.6,5.6l10.1-10.1
			c0.8-0.8,2-0.8,2.8,0c0.8,0.8,0.8,2,0,2.8L23.9,35.7C23.5,36.1,23,36.3,22.5,36.3z"/>
	</g>
</g>
</svg>

                April 12, 2019
              </p>
              
            </div>
            <div class="ibm--card__bottom"><p class="cpt-byline__categories"><span class="bx--tag bx--tag--category">Apache Cordova</span><span class="bx--tag bx--tag--category">Cloud</span><span class="bx--tag--category_more">+</span></p></div>
          </a>
        </div></div></div><div class="bx--row" data-widget="setsameheight" data-items=".ibm--card__body"></div></div></div>
        <script>
          document.addEventListener("DOMContentLoaded", function() {
            $sameHeightWidgets = document.querySelectorAll(".cpt__related_content [data-widget=\"setsameheight\"]");
            ibmcode.widgetSetSameHeight($sameHeightWidgets);
            var resizeTimer;
            ibmcode.addEvent(window,"resize",function(){
              clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function() {
                  ibmcode.widgetSetSameHeight($sameHeightWidgets,true);
                }, 250);
            })
          });
        </script>
		</div><!-- #content -->
	</div><!-- end of ibm-content-wrapper -->

</div>
</div>
<!-- end new layout -->

	<p class="ibm-ind-link ibm-nospacing ibm-icononly ibm-btt-auto ibm-hidden-small" style="display:none;">
		<a class="ibm-nospacing ibm-top-link" aria-label="Back to top" href="#top" tabindex="0">Back to top</a>
	</p>
		<section id="developerSearchFooter" class="developerSearchFooter">
		<form class="code_search__form hsearch" id="code_search__form" method="get" action="/">
			<input autocomplete="off" placeholder="Search" type="text" name="s" id="s" aria-label="Search IBM Developer" value="" />
			<button class="" type="submit" value="Submit" aria-label="Submit Search" role="button">
				<svg viewBox="0 0 16 16" fill-rule="evenodd">
					<title>Submit</title>
					<path d="M6 2c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zm0-2C2.7 0 0 2.7 0 6s2.7 6 6 6 6-2.7 6-6-2.7-6-6-6zm10 13.8L13.8 16l-3.6-3.6 2.2-2.2z" />
					<path d="M16 13.8L13.8 16l-3.6-3.6 2.2-2.2z" />
				</svg>
			</button>
		</form>
		<button class="searchModalClose" id="searchModalClose"><span class="dashicons dashicons-no-alt"></span></button>
		<div class="ibmDevSearchOverlay"></div>
	</section>

	<footer role="contentinfo" aria-label="IBM Developer Footer">
		<!-- developer footer here -->
		<div id="code-footer"class="code-footer">
			<div class="code_content__wrap">
				<div class="bx--grid">
					<div class="bx--row">
						<div class="bx--col-xs-6 bx--col-md-3">
							<ul>
								<li><a href="//developer.ibm.com/">IBM <b>Developer</b></a></li>
								<li><a href="//developer.ibm.com/about/">About</a></li>
								<li><a href="//developer.ibm.com/feedback/">Site Feedback &amp; FAQ</a></li>
								<li><a href="//developer.ibm.com/terms/submission-of-content-agreement/">Submit content</a></li>
								<li><a href="//www.ibm.com/developerworks/secure/report/">Report abuse</a></li>
								<li><a href="//developer.ibm.com/terms/third-party-notice/">Third-party notice</a></li>
							</ul>

							<h5>Follow us</h5>
							<div class="social-box">
								<p class="dw-footer-social">
		          		<a href="//twitter.com/IBMDeveloper">
		              	<img width="28" height="27" alt="Twitter" src="//dw1.s81c.com/developerworks/i/mf/dw-footer-icon-twitter.png">
		              </a>
		            </p>
								<p class="dw-footer-social-right">
				          <a href="//www.facebook.com/IBMDeveloper">
				          	<img width="28" height="27" alt="Facebook" src="//dw1.s81c.com/developerworks/i/mf/dw-footer-icon-facebook.png">
				          </a>
				      	</p>
								<p class="dw-footer-social">
									<a href="//www.linkedin.com/showcase/developerworks/">
										<img width="28" height="27" alt="LinkedIn" src="//dw1.s81c.com/developerworks/i/mf/dw-footer-icon-linkedin.png">
									</a>
								</p>
								<p class="dw-footer-social-right">
									<a href="//www.youtube.com/channel/UCUm6InQvGI9-6vo1teGWINA">
										<img width="28" height="27" alt="YouTube" src="//dw1.s81c.com/developerworks/i/mf/dw-footer-icon-youtube.png">
									</a>
								</p>
							</div>
						</div>
						<div class="bx--col-xs-6 bx--col-md-3">
							<ul>
								<li class="heading">Select a language</li>
								<li><a href="//developer.ibm.com/">English</a></li>
								<li><a href="//www.ibm.com/developerworks/cn/">中文</a></li>
								<li><a href="//www.ibm.com/developerworks/jp/">日本語</a></li>
								<li><a href="//www.ibm.com/developerworks/ru/">Русский</a></li>
								<li><a href="//www.ibm.com/developerworks/br/">Português</a></li>
								<li><a href="//www.ibm.com/developerworks/ssa/">Español</a></li>
								<li><a href="//developer.ibm.com/kr/">한글</a></li>
							</ul>
						</div>
						<div class="bx--col-xs-6 bx--col-md-3">
							<ul class="tr">
								<li><a href="//developer.ibm.com/patterns/">Code Patterns</a></li>
								<li><a href="//developer.ibm.com/articles/">Articles</a></li>
								<li><a href="//developer.ibm.com/tutorials/">Tutorials</a></li>
								<li><a href="//developer.ibm.com/recipes/">Recipes</a></li>
								<li><a href="//developer.ibm.com/open/">Open Source Projects</a></li>
							</ul>
						</div>
						<div class="bx--col-xs-6 bx--col-md-3">
							<ul class="tr">
								<li><a href="//developer.ibm.com/videos/">Videos</a></li>
								<li><a href="//developer.ibm.com/newsletters/">Newsletters</a></li>
								<li><a href="//developer.ibm.com/events/">Events</a></li>
								<li><a href="//developer.ibm.com/cities/">Cities</a></li>
								<li><a href="//developer.ibm.com/answers/">Answers</a></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- ibm footer here -->
		<div aria-label="IBM Global Footer" class="dw-footer" id="dw-footer">
			<div class="code_content__wrap">
					<div class="dw-footer-corporate-links">
							<ul>
									<li><a href="//developer.ibm.com/community/">Community</a></li>
									<li><a href="//www.ibm.com/privacy/us/en/">Privacy</a></li>
									<li><a href="//developer.ibm.com/terms/ibm-developer-terms-of-use/">Terms of use</a></li>
									<li><a href="//www.ibm.com/accessibility/us/en/">Accessibility</a></li>
									<li id="ibm-truste-cp"><a onclick="truste.eu.clickListener();return false;" href="#">Cookie Preferences</a></li>
							</ul>
					</div>
					<div id="ibm-footer-locale-selector"></div>
			</div>
		</div>
</footer>

<style>
	#modal-k7naq0vevup .bx--modal-container{
		max-width: 980px !important;
		padding:0 !important;
		height: 75% !important;
	}
	#modal-k7naq0vevup .bx--modal-content{
		margin-bottom: 0;
		height: 100%;
	}
	#modal-k7naq0vevup .bx--modal-container iframe{
		height:100%;
	}
</style>
<div data-modal id="modal-k7naq0vevup" class="bx--modal " role="dialog" aria-modal="true" aria-labelledby="modal-k7naq0vevup-label" aria-describedby="modal-k7naq0vevup-heading" tabindex="-1">
  <div class="bx--modal-container">
    <div class="bx--modal-header">
      <button class="bx--modal-close" type="button" data-modal-close aria-label="close modal"  data-modal-primary-focus>
        <svg class="bx--modal-close__icon" width="10" height="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg">
          <title>Close Modal</title>
          <path d="M6.32 5L10 8.68 8.68 10 5 6.32 1.32 10 0 8.68 3.68 5 0 1.32 1.32 0 5 3.68 8.68 0 10 1.32 6.32 5z" fill-rule="nonzero"
          />
        </svg>
      </button>
    </div>
    <div class="bx--modal-content">
      <iframe src="https://survey.medallia.eu/ibm-web-exp?tstamp=2019-04-08+12%3A44%3A34&lang=en&country=ZZ&pgroup=default&pparent=developerWorks Content/Raleigh/IBM&pmain=ZZ&oid=DWNEXT&content=ZZ000&campaign=null&oname=CodeStock+2019+%26%238211%3B+Knoxville&url=https%3A%2F%2Fdeveloper.ibm.com%2Farticles%2Fwa-http-server-push-with-websocket-sse%2F&id=n/a" width="970" height="212" frameborder="0"></iframe>
    </div>
  </div>
</div>

</div><!-- #page -->

<script type='text/javascript' src='https://developer.ibm.com/site-content/themes/lucio/js/navigation.js?ver=20151215'></script>
<script type='text/javascript' src='https://developer.ibm.com/site-content/themes/lucio/js/skip-link-focus-fix.js?ver=20151215'></script>
<script type='text/javascript' src='https://developer.ibm.com/site-content/plugins/page-links-to/js/new-tab.min.js?ver=3.0.0-beta.1'></script>
<script type='text/javascript' src='https://developer.ibm.com/wp-includes/js/wp-embed.min.js?ver=4.9.10'></script>
<script>

	var $searchTrigger = document.getElementById('search-trigger');

	if($searchTrigger != null){
		$searchTrigger.addEventListener('click', function(event) {
			window.location.href = 'https://developer.ibm.com?s=';
		});
	}


	$codeLeftNav = document.getElementById('code_leftnav');
	if($codeLeftNav != null){
		$codeLeftNav.addEventListener('click', function(event) {
				var clickedEl = event.target;
				if(clickedEl.tagName === 'A' && event.target.attributes.href.value === "#") {
					event.preventDefault();
				}
		});
	}

	document.addEventListener('click', function (event) {
		if ( event.target.classList.contains('bx--snippet__icon') ) {
			// Get the parent with the `.accordion` class
			var parentBtn = ibmcode.getClosest(event.target, '.bx--snippet-button');
			var codeBlock = parentBtn.previousElementSibling.querySelectorAll('code');
			if(codeBlock[0]){
				ibmcode.copyText(codeBlock[0]);
			}
		}
	}, false);

</script>
</body>
</html>
